import{a as ct,b as se,c as M}from"../chunks/chunk-75YVQ3JR.js";var Lt=document.getElementById("view");Lt.width=480;Lt.height=270;var F=480,m=270,A0=new OffscreenCanvas(F,m),p=A0.getContext("2d",{colorSpace:"srgb"});p.imageSmoothingEnabled=!1;var C0=Lt.getContext("2d",{colorSpace:"srgb"});C0.imageSmoothingEnabled=!1;Lt.style.filter="brightness(1.15) contrast(1.06)";var it=document.getElementById("mini"),N=it.getContext("2d");N.imageSmoothingEnabled=!1;var ae=document.getElementById("hpBar"),le=document.getElementById("ammoBar"),ce=document.getElementById("hpText"),fe=document.getElementById("ammoText"),de=document.getElementById("msg"),pe=document.getElementById("btnReset"),ue=document.getElementById("btnToggleMap");var mo=90*Math.PI/180,T0=mo*.5,b0=.01,D0=.01,xe=15;var Ht=.6,ft="#101b2e";var r={x:3.5,y:3.5,velX:0,velY:0,a:0,accel:10,rotSpeed:2.6,health:6,maxHealth:20,ammo:1,hasBlueKey:!1,isMoving:!1,weaponAnim:-1,tenacity:20,maxTenacity:20,height:.75,sightDist:15,mouseSensitivity:.22,height:1.2,calculatePlayerHeight:()=>{if(2-r.height<.01)return .01;let t=r.getCurrentFloorDepth?r.getCurrentFloorDepth():0;return(2-r.height-t)*1},getCurrentZoneId:()=>r._currentZoneId||0,getCurrentFloorDepth:()=>r._currentFloorDepth||0,_currentZoneId:0,_currentFloorDepth:0},F0=.2,_t=1,Ee=1,ho=99;function _0(t){_t=Math.max(Ee,Math.min(ho,t|0||Ee))}function c0(){let t=Math.cos(r.a),e=Math.sin(r.a),o=-e*Math.tan(T0),n=t*Math.tan(T0),s=1/(o*e-t*n);return{dirX:t,dirY:e,planeX:o,planeY:n,invDet:s}}var we=[{index:1,image:"OfficeWall.png"},{index:2,image:"Panel.png"},{index:3,image:"Hedge.png"},{index:4,image:"OfficeDoor.png"},{index:5,image:"Portal.png"},{index:6,image:"OfficeDoorBlue.png"},{index:7,image:"Field.png"},{index:8,image:"OfficeWall.png"},{index:9,image:"OfficeDoorBlue.png"}],Me={0:0,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:3,9:3};function go(t=64,e=64){return new OffscreenCanvas(t,e)}var st=new Array(8).fill(null);function Ae(t){let o=t.getContext("2d").getImageData(0,0,t.width,t.height),n=[];for(let s=0;s<t.width;s++){let i=new Uint8ClampedArray(t.height*4);for(let a=0;a<t.height;a++){let l=(a*t.width+s)*4,c=a*4;i[c]=o.data[l],i[c+1]=o.data[l+1],i[c+2]=o.data[l+2],i[c+3]=o.data[l+3]}n.push({data:i,h:t.height})}return{cols:n,w:t.width,h:t.height}}var Vt=st.map(t=>t?Ae(t):null);function yo(){Vt.length=0,st.forEach(t=>{Vt.push(t?Ae(t):null)})}var d0=Array.from({length:82},(t,e)=>e*.0125),f0={};function xo(){for(let t=1;t<st.length;t++)if(st[t]){f0[t]={};for(let e of d0){let o=new OffscreenCanvas(st[t].width,st[t].height),n=o.getContext("2d");n.drawImage(st[t],0,0);let s=e*255|0;n.globalCompositeOperation="multiply",n.fillStyle=`rgb(${s},${s},${s})`,n.fillRect(0,0,o.width,o.height),f0[t][e]=o}}}async function Eo(t){let e=`../assets/gfx/${t}`;return new Promise((o,n)=>{let s=new Image;s.onload=()=>{let i=go(64,64),a=i.getContext("2d",{willReadFrequently:!0});a.imageSmoothingEnabled=!1,a.drawImage(s,0,0,64,64),o(i)},s.onerror=()=>n(new Error(`Failed to load texture: ${e}`)),s.src=e})}async function Ce(){try{await wo(we),yo(),xo()}catch(t){console.warn("Failed to init wall textures:",t)}}async function wo(t){if(!Array.isArray(t)){console.warn("Expected an array of { index, image } objects. In loadImagesToReplaceTextures");return}let e=t.map(async(o,n)=>{let{index:s,image:i}=o||{};try{let a=await Eo(i);return s&&s>=0&&(st[s]=a),a}catch(a){return console.warn(`Failed to load texture "${i}" for index ${s} and dont support replacing with cool gmod missing texture:`,a),null}});await Promise.all(e)}var Se=[{name:"Village",mapLayout:[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,8,8,8,8,8,9,8,8,9,8,8,8,8,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],exitPos:{x:14,y:14},startPos:{x:9.5,y:1.5},zones:[{color:"#054213",x:0,y:0,w:1,h:1,floorColorBack:"#101b2e",cielingColorFront:"#6495ed",fogColor:"#101b2e",spawnRules:[]},{color:"#0011ff",x:0,y:2,w:20,h:2,cielingColorFront:"#6495ed",cielingColorBack:"#00000000",floorColorBack:"#03210a",fogColor:"#101b2e",spawnRules:[],floorDepth:-.5},{color:"#8b8000",x:3,y:5,w:14,h:12,cielingColorFront:"#8b8000",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",ceilingHeight:6,spawnRules:[{entityType:"entity",amount:5},{entityType:"barrel",amount:5},{entityType:"food",amount:2}]},{color:"#054213",x:1,y:0,w:18,h:19,cielingColorFront:"#6495ed",cielingColorBack:"#00000000",floorColorBack:"#03210a",fogColor:"#101b2e",spawnRules:[]}]},{name:"TowerFloor1",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,6,1,1,1,1,0,0,1,6,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,6,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,1,1,1,1,1,1,0,0,0,1,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1]],exitPos:{x:10,y:17},startPos:{x:5.5,y:4.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000",zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]},{name:"Gallery",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,0,0,0,3,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,1],[1,1,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,1,7,1,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,6],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[4,0,2,2,2,2,2,2,2,2,2,0,6,0,6,0,6,0,6,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,3,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],exitPos:{x:3,y:3},startPos:{x:1.5,y:21.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#ECDE60",floorColorBack:"#000000",sightDist:10,zones:[{color:"#888000",cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",x:0,y:0,w:0,h:0,spawnRules:[]},{color:"#888000",x:2,y:2,w:4,h:7,cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",spawnRules:[]},{color:"#888000",x:6,y:2,w:12,h:7,cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",spawnRules:[{entityType:"ball",amount:2},{entityType:"food",amount:1}]}]},{name:"LongHallways",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,3,3,3,3,0,4,0,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,1,6,1,1,1,6,1,1,1,6,1,1,1,6,1,1,0,0,3,3,3,3,3,0,0,0,3,3,3,3,3,0,0,1,1,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,6,0,1],[1,7,7,1,1,6,1,1,1,1,1,1,1,1,1,1,1,6,1,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,0,3,3,3,3,3,0,3,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,3,3,3,3,0,3,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,0,0,0,3,3,3,0,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,0,0,0,0,3,3,0,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,1,1,1],[1,7,7,1,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,4,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0,0,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],sightDist:10,exitPos:{x:1,y:1},startPos:{x:9.5,y:3.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000",zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]}];function Mt(t){if(!Array.isArray(t)||t.length===0)throw new Error("Array must be non-empty.");let e=Q(t.length)-1;return t[e]}function Q(t){if(t<=0)throw new Error("The maximum value must be greater than 0.");return Math.floor(Math.random()*t)+1}function p0(t,e,o){return t+(e-t)*o}function Te(t,e){let o=t?t.length:0;if(o===0)return-1;if(e<=t[0])return 0;if(e>=t[o-1])return o-1;let n=0,s=o-1;for(;n<=s;){let i=n+s>>1,a=t[i];if(a===e)return i;a<e?n=i+1:s=i-1}return e-t[s]<=t[n]-e?s:n}function k0(t){let e=t.charCodeAt(0)===35?t.slice(1):t,o=parseInt(e.length===3?e.split("").map(n=>n+n).join(""):e,16);return[o>>16&255,o>>8&255,o&255]}var dt={x:10,y:8},At={x:3.5,y:3.5};var f={MAP:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,2,6,2,0,0,0,0,0,0,0,2,6,2,0,0,1],[1,0,0,0,2,0,2,0,0,0,0,0,0,0,2,0,2,0,0,1],[1,0,0,0,2,2,2,0,0,0,0,0,0,0,2,2,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,5,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,3,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,3,3,1,3,3,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,0,0,0,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,2,2,2,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,1,0,2,0,2,0,1,0,3,0,0,0,1],[1,0,0,0,0,0,0,0,0,2,6,2,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],MAP_W:-1,MAP_H:-1,cielingColorFront:"",floorColorFront:"",cielingColorBack:"",floorColorBack:"",dontPersist:!1,sightDist:15,zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]},$t=Se,be=new Map;function Fe(t){let e=f.zones,o=e&&e[t]?.color||ft,n=be.get(o);return n||(n=k0(o),be.set(o,n)),n}var De=new Map;function _e(t){let e=f.zones,o=e&&e[t]?.cielingColorFront||ft,n=De.get(o);return n||(n=k0(o),De.set(o,n)),n}function ke(t,e,o){for(let n=0;n<o.length;n++){let s=o[n],i=Math.min(s.x,s.x+s.w),a=Math.max(s.x,s.x+s.w)-1,l=Math.min(s.y,s.y+s.h),c=Math.max(s.y,s.y+s.h)-1;if(t>=i&&t<=a&&e>=l&&e<=c)return n}return 0}var tt=new Float32Array(F),H=m>>1,Ut=new Int16Array(F).fill(H),h0=new Int16Array(F).fill(H),Bt=new Float32Array(m),R0=new Float32Array(m),u0={},Yt={};function Zt(){for(let i in Yt)delete Yt[i];for(let i in u0)delete u0[i];let t=H,e=r.calculatePlayerHeight(),n=2-0,s=m*(n-e)*.5;for(let i=0;i<m;i++){let a=i-t;Bt[i]=a!==0?s/a:1e-6;let c=2-2,d=m*(c+e)*.5;R0[i]=a!==0?-d/a:-1e-6}for(let i=0;i<f.zones.length;i++){let a=f.zones[i];if(a.ceilingHeight!==void 0){Yt[i]=new Float32Array(m);for(let l=0;l<m;l++){let c=l-t,h=a.ceilingHeight-2,g=m*(h+e)*.5;Yt[i][l]=c!==0?-g/c:-1e-6}}if(a.floorDepth!==void 0){let c=2-a.floorDepth,d=m*(c-e)*.5;u0[i]=new Float32Array(m);for(let h=0;h<m;h++){let g=h-t;u0[i][h]=g!==0?d/g:1e-6}}}}Zt();var I0=[],P0=[],O0=[],g0=[],X=[],L0=[];function ve(){I0.length=0,P0.length=0,O0.length=0,g0.length=0,L0.length=0,H0.clear(),B0.clear()}function qt(t,e,o,n,s,i,a,l,c,d){if(!s)return;let h=n-o;if(h<=0)return;let g=l||0,y=g<0?0:g>s.height?s.height:g,x=c||s.height,E=s.height-y,u=x<0?0:x>E?E:x,R=Te(d0,a);t.drawImage(f0[d][d0[R]],i,y,1,u,e,o,1,h)}function Re(t){let e=r.x|0,o=r.y|0,n=X[o*f.MAP_W+e],s=I0[n];if(!s){s=t.createLinearGradient(0,0,0,H);let i=f.zones[n].cielingColorFront,a=f.zones[n].cielingColorBack,l=f.zones[n].fogColor;s.addColorStop(0,i||f.cielingColorFront||"#6495ED"),f.cielingColorBack&&s.addColorStop(.5,a||f.cielingColorBack||"#6495ED"),s.addColorStop(.9,l||ft),I0[n]=s}t.fillStyle=s,t.fillRect(0,0,F,H)}var H0=new Map;function v0(t){let e=H0.get(t);if(!e){let[o,n,s]=Fe(t);e=`rgb(${o|0},${n|0},${s|0})`,H0.set(t,e)}return e}var B0=new Map;function m0(t){let e=B0.get(t);if(!e){let[o,n,s]=_e(t);e=`rgb(${o|0},${n|0},${s|0})`,B0.set(t,e)}return e}function Ie(){X.length=0;let t=f.zones,e=f.MAP_W,o=f.MAP_H;for(let n=0;n<o;n++)for(let s=0;s<e;s++)X[n*e+s]=ke(s,n,t)}function Pe(t,e,o,n=0){let{dirX:s,dirY:i,planeX:a,planeY:l}=e;n=Ut[o]??H;let c=n<H?H:n;if(c>=m)return;let d=2*(o+.5)/F-1,h=s+a*d,g=i+l*d;if(r.sightDist>0){let T=tt[o]??1/0;for(;c<m;){let C=Bt[c]??1/0;if(C<=r.sightDist&&C<=T)break;c++}if(c>=m)return}let y="#000000",x=f.MAP_W,E=f.MAP_H,u=1/(s*h+i*g),R=h*u,W=g*u,w=0;function _(T,C=0){let V=Bt[T]??Bt[Bt.length-1]??1/0,G=r.x+R*V,b=r.y+W*V,D=G|0,ot=b|0;return D>=0&&ot>=0&&D<x&&ot<E?X[ot*x+D]:0}let L=T=>Math.max(8,Math.min(64,8+(T-H>>>3)));w=_(c,w);let A=c,I=null;for(;c<m;){let T=Math.min(L(c),m-1-c);if(T<=0)break;let C=c+T;if(_(C,w)===w){let j=c+C>>1;if(_(j,w)===w){let P=v0(w);P!==I&&(p.fillStyle=P,I=P);let nt=C+1-A;nt>0&&p.fillRect(o,A,1,nt),c=C+1,A=c;continue}}let G=c,b=C;for(;b-G>1;){let j=G+b>>1;_(j,w)===w?G=j:b=j}let D=v0(w);D!==I&&(p.fillStyle=D,I=D);let ot=b-A;ot>0&&p.fillRect(o,A,1,ot);let mt=_(b,w),It=f.zones[w]?.floorDepth??0,o0=f.zones[mt]?.floorDepth??0,n0=Ut[o]??H,r0=Bt[b]??1/0,i0=tt[o]??1/0,s0=b===n0,a0=r0>=i0-.11;if(!!y&&It!==o0&&!s0&&!a0&&!(A===n0)){let j=It>o0?5:1,P=b,nt=Math.min(m,P+j);nt>P&&(p.fillStyle!==y&&(p.fillStyle=y),p.fillRect(o,P,1,nt-P)),I=null,w=mt,c=nt,A=c;continue}w=mt,c=b,A=c}if(A<m){let T=v0(w);T!==I&&(p.fillStyle=T),p.fillRect(o,A,1,m-A)}}function Oe(t,e,o,n=0){let{dirX:s,dirY:i,planeX:a,planeY:l}=e,c=h0[o]??H,d=0;if(c<=0)return;let h=2*(o+.5)/F-1,g=s+a*h,y=i+l*h,x=1/(s*g+i*y),E=0,u=Yt?.[E]?.[d]??R0[d],R=r.x+g*u*x,W=r.y+y*u*x,w=d,_=null;for(let A=d;A<c;A++){if(r.sightDist>0&&Math.abs(u)>r.sightDist){let b=m0(E);b!==_&&(p.fillStyle=b),p.fillRect(o,w,1,A-w);return}if(u>tt[o]){let b=m0(E);b!==_&&(p.fillStyle=b),p.fillRect(o,w,1,A-w);return}let I=R|0,T=W|0,C=I>=0&&T>=0&&I<f.MAP_W&&T<f.MAP_H?X[T*f.MAP_W+I]:E;if(C!==E){let b=m0(E);b!==_&&(p.fillStyle=b,_=b),p.fillRect(o,w,1,A-w),E=C,w=A}let V=Yt?.[E]?.[A+1]??R0[A+1]??u,G=V-u;R+=g*G*x,W+=y*G*x,u=V}let L=m0(E);L!==_&&(p.fillStyle=L),p.fillRect(o,w,1,c-w)}function Le(t){let e=O0[0];e||(e=t.createLinearGradient(0,0,0,m),e.addColorStop(0,"rgba(16,27,46,0.08)"),e.addColorStop(.5,"rgba(16,27,46,0.16)"),e.addColorStop(1,"rgba(16,27,46,0.20)"),O0[0]=e),t.fillStyle=e,t.fillRect(0,0,F,m)}function He(t){let e=H-1,o=m-e,n=r.x|0,s=r.y|0,i=X[s*f.MAP_W+n],a=P0[i];if(!a){let l=f.zones[i].floorColorBack;a=t.createLinearGradient(0,e,0,m),a.addColorStop(.05,f.zones[i].fogColor||ft),a.addColorStop(.15,l||f.floorColorBack||"#03210A"),a.addColorStop(1,"rgba(0,0,0,0)"),P0[i]=a}t.fillStyle=a,t.fillRect(0,e,F,o)}function Be(t){let o=H+1,n=r.x|0,s=r.y|0,i=X[s*f.MAP_W+n],a=L0[i];if(!a){let l=f.zones[i].fogColor||ft,c=f.zones[i].cielingColorBack||f.cielingColorBack||"#6495ED";a=t.createLinearGradient(0,0,0,0+o),a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(.85,c),a.addColorStop(.95,l),L0[i]=a}t.fillStyle=a,t.fillRect(0,0,F,o)}function Ye(t,e,o,n,s){let{dirX:i,dirY:a,planeX:l,planeY:c}=e;for(let d=0;d<F;d++){let h=2*(d+.5)/F-1,g=i+l*h,y=a+c*h;if(g<1e-8&&g>-1e-8&&y<1e-8&&y>-1e-8){tt[d]=Number.POSITIVE_INFINITY,Ut[d]=H,h0[d]=H;continue}let x=1/(g||1e-9),E=1/(y||1e-9),u=r.x|0,R=r.y|0,W=x<0?-x:x,w=E<0?-E:E,_,L,A,I;g<0?(_=-1,A=(r.x-u)*W):(_=1,A=(u+1-r.x)*W),y<0?(L=-1,I=(r.y-R)*w):(L=1,I=(R+1-r.y)*w);let T=0,C=1,V=!1,G=0,b=0;for(;!V&&G++<256;){if(A<I?(A+=W,u+=_,T=0):(I+=w,R+=L,T=1),r.sightDist>0){let K=Math.min(A,I);if(K>r.sightDist){V=!1,C=0,b=K;break}}if(u<0||R<0||u>=n||R>=s){V=!0,C=1;break}let B=o[R][u];if(B>0){V=!0,C=B;break}}if(C===0){tt[d]=Number.POSITIVE_INFINITY,Ut[d]=H,h0[d]=H;continue}let D;T===0?D=A-W:D=I-w,D=b0>D?b0:D;let ot=0,mt=T===0?_:0,It=T===1?L:0,s0=Math.abs(mt*i+It*a)>=.9&&Math.abs(h)<=.9&&D<ot?ot:D,a0=r.x+s0*g,M0=r.y+s0*y,xt;T===0?xt=M0-(M0|0):xt=a0-(a0|0),xt=xt<0?0:xt>.999999?.999999:xt+1e-6;let j=Vt[C]||Vt[4],P=st[C],nt=P?P.width|0:j.w|0,rt=xt*nt|0;(T===0&&_>0||T===1&&L<0)&&(rt=nt-rt-1),rt=rt<0?0:rt>=nt?nt-1:rt;let po=D<D0?D0:D,Et=m/po|0,Xt=(m-Et*r.calculatePlayerHeight())/2|0,zt=Xt+Et,Tt=Xt,Pt=zt;Tt<0&&(Tt=0),Pt>m&&(Pt=m);let oe=Pt-Tt;Ut[d]=Pt;let ht=Me[C]||1;if(h0[d]=Tt*ht,oe<=0){tt[d]=D;continue}let ne=(P?P.height:j.h||st[C]?.height||64)|0,re=(Tt-Xt)*(ne/(Et>1?Et:1)),ie=oe*(ne/Math.max(1,Et)),Ot=1/(1+D*.25)*(T?.5:1);if(C===7&&(Ot*=.8+.2*Math.sin(t*6+d*.05)),ht==1)qt(p,d,Tt,Pt,P,rt,Ot,re,ie,C);else if(ht>1){qt(p,d,Tt,Pt,P,rt,Ot,re,ie,C);let B=Et,K=(P?.height||j.h||64)|0,at=K/Math.max(1,B),wt=Math.floor(ht)-1;for(let Y=0;Y<wt;Y++){let $=Xt-B*(Y+1),gt=zt-B*(Y+1),J=Math.max(0,Math.ceil($)),lt=Math.min(m,Math.floor(gt)),bt=lt-J;if(bt<=0)continue;let Dt=(J-$)*at,Ft=bt*at;qt(p,d,J,lt,P,rt,Ot,Dt,Ft,1)}let Gt=ht-(1+wt);if(Gt>1e-6){let Y=B*Gt,$=Xt-B*wt,gt=$-Y,J=Math.max(0,Math.ceil(gt)),lt=Math.min(m,Math.floor($)),bt=lt-J;if(bt>0){let Dt=$-B,Ft=(J-Dt)*at%K;Ft<0&&(Ft+=K);let uo=bt*at;qt(p,d,J,lt,P,rt,Ot,Ft,uo,1)}}}else if(ht<1){let B=Et,K=(P?.height||j.h||64)|0,at=K/Math.max(1,B),wt=ht;if(wt>1e-6){let Gt=B*wt,Y=zt,$=Y-Gt,gt=Math.max(0,Math.ceil($)),J=Math.min(m,Math.floor(Y)),lt=J-gt;if(lt>0){let bt=Y-B,Dt=(gt-bt)*at%K;Dt<0&&(Dt+=K);let Ft=lt*at;qt(p,d,gt,J,P,rt,Ot,Dt,Ft,C)}}}if(r.sightDist>0&&D>r.sightDist*Ht){let B=r.sightDist*Ht,K=r.sightDist,at=Math.min(1,Math.max(0,(D-B)/Math.max(1e-6,K-B)));if(at>0){let wt=zt,Y=zt-Et*(ht>0?ht:1)|0,$=wt|0;if(Y<0&&(Y=0),$>m&&($=m),$>Y){let gt=r.x|0,J=r.y|0,lt=X.length>0?X[J*f.MAP_W+gt]:0;p.save(),p.globalAlpha=at*.85,p.fillStyle=f.zones[lt].fogColor||ft,p.fillRect(d,Y,1,$-Y),p.restore()}}}tt[d]=D}}var k={aiDrone1:null,ball:null,sparkle:null,barrel:null,food:null,keycard1:null,aiDrone2:null,aiDrone3:null,pitchfork:null,bow:null};async function pt(t,e){return await Mo(t,e,1)}async function Mo(t,e=1,o=1){let n=`../assets/gfx/${t}`;return new Promise((s,i)=>{let a=new Image;a.onload=()=>{let l=new OffscreenCanvas(a.width*e,a.height*e),c=l.getContext("2d");c.imageSmoothingEnabled=!1,c.drawImage(a,0,0,l.width,l.height),l.baseline=o,l.scale=e,s(l)},a.onerror=()=>i(new Error(`Failed to load sprite: ${n}`)),a.src=n})}async function Ne(){k.food=await pt("noodles.png",3),k.bow=await pt("bow.png",3),k.pitchfork=await pt("pitchfork.png",3),k.keycard1=await pt("keycard1.png",3),k.barrel=await pt("emp.png",3),k.aiDrone1=await pt("aiDrone1.png",3),k.aiDrone2=await pt("aiDrone2.png",3),k.aiDrone3=await pt("aiDrone3.png",3),k.ball=await pt("Palantrash1.png",3),k.sparkle=await pt("sparkle.png",3)}var O=[];function Ao(t){return m/t}function Co(t,e,o){let{dirY:n,dirX:s,planeY:i,planeX:a,invDet:l}=o,c=l*(n*t-s*e),d=l*(-i*t+a*e);return{transX:c,transY:d}}function So(t,e){return Math.round((F>>1)*(1+t/e))}function jt(t,e){let o=t.x-r.x,n=t.y-r.y,{transX:s,transY:i}=Co(o,n,e);if(i<=.01)return null;let a=So(s,i),l=t&&typeof t.scale=="number"?t.scale:t&&k[t.img]&&typeof k[t.img].scale=="number"?k[t.img].scale:1,c=Ao(i)*l,d=typeof t._hR=="number"?t._hR:Math.round(c),h=.1,g=d;(c>d+h||c<d-h)&&(g=Math.round(c)),t._hR=g;let y=g,x=k[t.img],E=x&&x.width&&x.height?x.width/x.height:1,u=Math.max(1,Math.round(y*E)),R=r.calculatePlayerHeight(),W=m*.5,w=0,_,L;if(t.ground){let C=t.floorBiasFrac??.04,V=X[(t.y|0)*f.MAP_W+(t.x|0)],G=f.zones[V],b=2-(G.floorDepth||0),D=W+m*(b-R)/(2*i)-C*y,ot=D-y;if(_=Math.round(ot),L=Math.round(D),G){let mt=G.floorDepth??0;if(mt<0){let It=mt<0?-mt:0,r0=ct(It/1.2,0,1),i0=ct(r0,0,1);w=Math.min(y-1,Math.round(y*i0))}}}else{let C=Math.round(W-y*.5);_=C,L=C+y}let A={startY:_,endY:L},I=Math.round(a-(u>>1)),T=I+u;return{drawStartX:I,drawEndX:T,drawStartY:A.startY,drawEndY:A.endY,depth:i,size:y,width:T-I,occludedBottom:w}}var We={0:"#0c1220",1:"#ECDE60",2:"#707a88",3:"#00e676",4:"#996633",5:"#FFE300",6:" #3561ff",7:"#00FFFF"},Y0={[M.entity]:"#ffeb9c",[M.barrel]:"#CD1C18",[M.key]:"#6aa2ff",[M.food]:"#7fffd4",default:"#ffffff"};var et=6,kt=20,ut=2,Xe=Math.floor(kt/2);it.width=ut+kt*et+ut;it.height=ut+kt*et+ut;function ze(t){N.clearRect(0,0,it.width,it.height);let e=Math.max(0,Math.min((r.x|0)-Xe,f.MAP_W-kt)),o=Math.max(0,Math.min((r.y|0)-Xe,f.MAP_H-kt));for(let l=0;l<kt;l++)for(let c=0;c<kt;c++){let d=o+l,h=e+c,g=f.MAP[d]?.[h]??0,y=We[g]||"#000000";N.fillStyle=y,N.fillRect(ut+c*et,ut+l*et,et-1,et-1)}for(let l of t){if(!l.alive)continue;let c=ut+(l.x-e)*et,d=ut+(l.y-o)*et;N.fillStyle=Y0[l.type]||Y0.default,N.fillRect(c-2,d-2,4,4)}let n=ut+(r.x-e)*et,s=ut+(r.y-o)*et;N.fillStyle="#e7f3ff",N.beginPath(),N.arc(n,s,2.5,0,se),N.fill();let i=Math.cos(r.a),a=Math.sin(r.a);N.strokeStyle="#78f3d3",N.beginPath(),N.moveTo(n,s),N.lineTo(n+i*1.5*et,s+a*1.5*et),N.stroke()}var v=null,vt=null,U=null,N0=null,Ge=null;function X0(){v||(v=new(window.AudioContext||window.webkitAudioContext))}function q({freq:t=440,dur:e=.1,type:o="square",vol:n=.2,slide:s=0}){if(!v)return;let i=v.createOscillator(),a=v.createGain();i.type=o,i.frequency.value=t,a.gain.value=n,i.connect(a).connect(v.destination);let l=v.currentTime;s&&(i.frequency.setValueAtTime(t,l),i.frequency.linearRampToValueAtTime(t+s,l+e)),a.gain.setValueAtTime(n,l),a.gain.exponentialRampToValueAtTime(.001,l+e),i.start(l),i.stop(l+e)}function W0({dur:t=.2,vol:e=.2,lp:o=1200}){if(!v)return;let n=v.createBuffer(1,v.sampleRate*t,v.sampleRate),s=n.getChannelData(0);for(let d=0;d<s.length;d++)s[d]=Math.random()*2-1;let i=v.createBufferSource(),a=v.createGain(),l=v.createBiquadFilter();i.buffer=n,a.gain.value=e,l.type="lowpass",l.frequency.value=o,i.connect(l).connect(a).connect(v.destination);let c=v.currentTime;i.start(c),i.stop(c+t)}var z={shot:()=>{let t=Q(50),e=-Q(50);q({freq:220+t+e,dur:.05+Q(3)/100,type:"square",vol:.25,slide:120}),W0({dur:.03+Q(3)/100,vol:.15,lp:800})},pickup:()=>{q({freq:880,dur:.06,type:"triangle",vol:.2}),q({freq:1180,dur:.08,type:"triangle",vol:.18})},explode:()=>{W0({dur:1,vol:.3,lp:800}),q({freq:90,dur:.7,type:"sawtooth",vol:.12,slide:-60})},hurt:()=>{q({freq:140,dur:.12,type:"sawtooth",vol:.2,slide:-50})},killedEntity:()=>{let t=Math.random()*16-8;q({freq:320+t,dur:.26,type:"triangle",vol:.3,slide:-220}),q({freq:480+t,dur:.22,type:"sawtooth",vol:.1,slide:-260}),q({freq:90,dur:.08,type:"sine",vol:.18}),W0({dur:.05,vol:.1,lp:1e3}),setTimeout(()=>{q({freq:170+t,dur:.07,type:"triangle",vol:.16,slide:70})},90)},door:()=>{q({freq:420,dur:.12,type:"square",vol:.15})},portal:()=>{q({freq:600,dur:.5,type:"sawtooth",vol:.2}),q({freq:400,dur:.3,type:"sawtooth",vol:.2,slide:50}),q({freq:600,dur:.5,type:"sawtooth",vol:.2})}};async function To(t,{volume:e=.15}={}){if(v)try{if(!N0||t!==Ge){let n=await(await fetch(t,{cache:"force-cache"})).arrayBuffer();N0=await v.decodeAudioData(n),Ge=t}Ve(),U=v.createBufferSource(),U.buffer=N0,U.loop=!0,vt=v.createGain(),vt.gain.value=e,U.connect(vt).connect(v.destination),U.start()}catch(o){try{Ve();let n=new Audio(t);n.loop=!0,n.volume=Math.max(0,Math.min(1,e)),await n.play(),U={stop:()=>n.pause(),disconnect:()=>{}},vt=null}catch(n){}}}function Ve(){try{U&&U.stop(0)}catch(t){}if(U&&U.disconnect)try{U.disconnect()}catch(t){}if(vt)try{vt.disconnect()}catch(t){}U=null,vt=null}var $e=!1;async function z0(){if(!v||U||$e)return;$e=!0,await To("../assets/sfx/HexenST02SLowed.ogg",{volume:.12})}function Rt(t,e){if(t<0||e<0||t>=f.MAP_W||e>=f.MAP_H)return!0;let o=f.MAP[e|0][t|0];return o===0||o===5?!1:o===7?!r.hasBlueKey:!(o===6||o===9)}function Ct(t,e,o){return!!(Rt(t,e)||Rt(t-o,e)||Rt(t+o,e)||Rt(t,e-o)||Rt(t,e+o))}var Nt={EXPLOSION:"explosion",SCREEN_FLASH:"screen_flash"},bo={[Nt.EXPLOSION]:{lifetime:.5,startRadius:.1,endRadius:1,expansionTime:.4,startOpacity:1,endOpacity:0,primaryColor:{h:30,s:90,l:60},secondaryColor:{h:15,s:85,l:50},glowColor:{h:45,s:100,l:75},fillColor:{h:25,s:80,l:40},ringLineWidth:3,glowLineWidth:2,innerLineWidth:1,renderFunction:Io,ignoreBounds:!1},[Nt.SCREEN_FLASH]:{lifetime:.15,startOpacity:.85,endOpacity:0,color:"#ffffff",renderFunction:Po,ignoreBounds:!0}},Kt=[];function qe(t,e,o,n,s={}){let i=bo[t];if(!i)return console.warn(`Unknown effect type: ${t}`),null;let a={ignoreBounds:!1,type:t,x:e,y:o,radius:n,maxRadius:n,age:0,lifetime:s.lifetime??i.lifetime,opacity:s.startOpacity??i.startOpacity,startOpacity:s.startOpacity??i.startOpacity,endOpacity:s.endOpacity??i.endOpacity,...i,...s};return Kt.push(a),a}function Ue(t,e,o,n={}){return qe(Nt.EXPLOSION,t,e,o,n)}function G0({color:t="#ffffff",duration:e=.15,alpha:o=.85}={}){qe(Nt.SCREEN_FLASH,0,0,1,{lifetime:e,startOpacity:o,endOpacity:0,color:t,ignoreBounds:!0})}function Ze(t){for(let e=Kt.length-1;e>=0;e--){let o=Kt[e];o.age+=t;let n=Math.min(o.age/o.lifetime,1);Do(o,n),o.age>=o.lifetime&&Kt.splice(e,1)}}function Do(t,e){switch(t.type){case Nt.EXPLOSION:Fo(t,e);break;case Nt.SCREEN_FLASH:_o(t,e);break}}function Fo(t,e){t.opacity=p0(t.startOpacity,t.endOpacity,e);let o=Math.min(e/t.expansionTime,1),n=p0(t.startRadius,t.endRadius,o);t.radius=t.maxRadius*n}function _o(t,e){let o=1-(1-e)*(1-e);t.opacity=p0(t.startOpacity,t.endOpacity,o)}function ko(){return Kt}function je(t,e,o,n,s){let i=ko();if(i.length!==0){t.save();for(let a of i)vo(t,a,e,o,n,s);t.restore()}}function vo(t,e,o,n,s,i){let a=Ro(e.x,e.y,o,n,s,i,e.ignoreBounds);!a&&!e.ignoreBounds||e.renderFunction(t,e,a)}function Ro(t,e,o,n,s,i,a=!1){let l=t-i.x,c=e-i.y,{dirY:d,dirX:h,planeY:g,planeX:y,invDet:x}=o,E=x*(d*l-h*c),u=x*(-g*l+y*c);return u<=.1&&!a?null:a?{x:n/2,y:s/2,radius:s,depth:u}:{x:n/2*(1+E/u),y:s/2+64,radius:s/u*.5,depth:u}}function Io(t,e,o){let n=o.radius*e.radius,s=performance.now()*.001,i=Math.sin(s*8)*12,a=Math.sin(s*12)*.15+1,l=o.y,c=o.x;t.globalAlpha=e.opacity*.3,t.fillStyle=`hsl(${e.fillColor.h+i*.5}, ${e.fillColor.s}%, ${e.fillColor.l}%)`,t.beginPath(),t.arc(c,l,n*.7,0,2*Math.PI),t.fill(),t.globalAlpha=e.opacity*.5,t.strokeStyle=`hsl(${e.glowColor.h+i}, ${e.glowColor.s}%, ${e.glowColor.l}%)`,t.lineWidth=e.glowLineWidth*1.5,t.beginPath(),t.arc(c,l,n*a,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.85,t.strokeStyle=`hsl(${e.primaryColor.h+i*.8}, ${e.primaryColor.s}%, ${e.primaryColor.l}%)`,t.lineWidth=e.ringLineWidth,t.beginPath(),t.arc(c,l,n*.9,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.6,t.strokeStyle=`hsl(${e.secondaryColor.h+i*1.3}, ${e.secondaryColor.s}%, ${e.secondaryColor.l}%)`,t.lineWidth=e.innerLineWidth,t.beginPath(),t.arc(c,l,n*.5,0,2*Math.PI),t.stroke()}function Po(t,e){if(e.opacity<=0)return;let o=t.canvas.width,n=t.canvas.height;t.save(),t.globalAlpha=e.opacity,t.fillStyle=e.color||"#ffffff",t.fillRect(0,0,o,n),t.restore()}var Qt={[M.entity]:{type:M.entity,ground:!0,scale:.66,floorBiasFrac:0,animationTime:0,animationFrame:0,img:"aiDrone1"},[M.ball]:{type:M.ball,ground:!1,scale:.75,floorBiasFrac:0,cooldownTime:.5,health:3,img:"ball"},[M.sparkle]:{type:M.sparkle,ground:!1,scale:.75,floorBiasFrac:0,cooldownTime:3,img:"sparkle"},[M.barrel]:{type:M.barrel,ground:!0,scale:.66,floorBiasFrac:0,img:"barrel"},[M.food]:{type:M.food,ground:!0,scale:.25,floorBiasFrac:0,img:"food"},[M.key]:{type:M.key,ground:!0,scale:.25,floorBiasFrac:0,img:"keycard1"}},V0=null,Jt=null;function Ke(t,e){V0=t,Jt=e}var t0={[M.ball]:{ai(t,e){if(!t.alive)return;t.cooldownTime-=e,t.cooldownTime<=0&&(t.cooldownTime=.5,V0&&O.push(V0(M.sparkle,{x:t.x,y:t.y})));let o=r.x-t.x,n=r.y-t.y,s=Math.hypot(o,n);if(s>.3){let i=1*e,a=o/s,l=n/s,c=t.x+a*i,d=t.y+l*i;Ct(c,t.y,.4)||(t.x=c),Ct(t.x,d,.4)||(t.y=d)}s<.6&&t.hurtCD<=0&&(r.health=Math.max(0,r.health-3.33)|0,yt(),S("Ball attacks!"),z.hurt(),t.hurtCD=.8,G0({color:"	#740707",duration:.5}),q0()),t.hurtCD>0&&(t.hurtCD-=e)},onHit(t,e){e?t.health>1?(S(Mt(["Ball Hit!"])),t.health-=1,z.killedEntity()):(t.alive=!1,S(Mt(["Ball Busted!"])),z.killedEntity()):S("No arrows.")},onTouch(t){y0(M.entity,1e4)&&S("You hear something like echoes nearby...")},onExplode(t){t.alive=!1,z.killedEntity(),S("The ball is blown to bits.")}},[M.sparkle]:{ai(t,e){t.alive&&(t.cooldownTime-=e,t.cooldownTime<=0&&(t.alive=!1))}},[M.entity]:{ai(t,e){if(!t.alive)return;switch(t.animationTime+=e,t.animationTime>.2&&(t.animationTime-=.2,t.animationFrame+=1,t.animationFrame%=4),t.animationFrame){case 0:t.img="aiDrone1";break;case 1:t.img="aiDrone2";break;case 2:t.img="aiDrone3";break;case 3:t.img="aiDrone2";break}let o=r.x-t.x,n=r.y-t.y,s=Math.hypot(o,n);if(s>.3){let i=1.5*e,a=o/s,l=n/s,c=t.x+a*i,d=t.y+l*i;Ct(c,t.y,.4)||(t.x=c),Ct(t.x,d,.4)||(t.y=d)}s<.6&&t.hurtCD<=0&&(r.health=Math.max(0,r.health-3.33)|0,yt(),S("Entity attacks!"),z.hurt(),t.hurtCD=.8,G0({color:"	#740707",duration:.5}),q0()),t.hurtCD>0&&(t.hurtCD-=e)},onHit(t,e){e?(t.alive=!1,S(Mt(["Entity murdered!","Entity destroyed!","Entity purged!"])),z.killedEntity()):S("No arrows.")},onTouch(t){y0(M.entity,1e4)&&S("You hear something like water nearby...")},onExplode(t){t.alive=!1,z.killedEntity(),S("The entity is blown to gibs.")}},[M.barrel]:{onHit(t,e){e?(t.alive=!1,Jt&&Jt(t.x,t.y,2.5),S("Kaboom!"),z.explode()):S("No arrows.")},onTouch(t){y0(M.barrel,1e4)&&S("Shooting this barrel may yield useful results...")},onExplode(t){t.alive=!1,Jt&&Jt(t.x,t.y,2.5)}},[M.food]:{onTouch(t){t.alive=!1;let e=r.health>=r.maxHealth;e&&(r.maxHealth+=1),r.health=ct(r.health+10,0,r.maxHealth),S(e?"Yummy!":"Health restored."),yt(),z.pickup()},onExplode(t){}},[M.key]:{onTouch(t){t.alive=!1,r.hasBlueKey=!0,z.door(),S("Keycard found! Find the exit!"),$0()},onExplode(t){t.alive=!1,r.hasBlueKey=!0,z.door(),S("The forcefield protecting the exit has suddenly lifted!"),$0()}}};Object.freeze(Qt);for(let t in Qt)Object.freeze(Qt[t]);Object.freeze(t0);for(let t in t0)Object.freeze(t0[t]);var Oo=Qt,Lo=t0,Ho=0;function St(t,e={x:0,y:0},o=void 0){let n=Oo[t],s=Lo[t],i=Object.assign(Object.create(s),n);return i.id=Ho++,i.x=e.x,i.y=e.y,i.dist=0,i.alive=!0,i.hurtCD=0,o&&Object.assign(i,o),i}function Bo(t,e,o){Ue(t,e,o);for(let n of O){if(!n.alive)continue;Math.hypot(n.x-t,n.y-e)<o&&(n.onExplode?n.onExplode(n):n.alive=!1)}}Ke(St,Bo);var U0=0,Z=new Set,Yo=0,Z0=!1;function to(t){window.addEventListener("keydown",e=>{if(Z.add(e.code),X0(),z0(),e.code==="Space"&&(e.preventDefault(),Je()),e.code==="KeyM"&&(e.preventDefault(),it.classList.toggle("visible")),e.code==="Enter"&&(!!document.pointerLockElement||!!document.mozPointerLockElement||!!document.webkitPointerLockElement?document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock():t.requestPointerLock?t.requestPointerLock():t.mozRequestPointerLock?t.mozRequestPointerLock():t.webkitRequestPointerLock&&t.webkitRequestPointerLock()),e.code==="Escape"&&(document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock()),e.code==="BracketLeft")switch(r.mouseSensitivity){case .33:S("Mouse sensitivity set to high."),r.mouseSensitivity=.22;break;case .22:S("Mouse sensitivity set to medium."),r.mouseSensitivity=.11;break;case .11:S("Mouse sensitivity set to low."),r.mouseSensitivity=.05;break;case .05:S("Mouse sensitivity already lowest."),r.mouseSensitivity=.05;break}if(e.code==="BracketRight")switch(r.mouseSensitivity){case .33:S("Mouse sensitivity already set to highest."),r.mouseSensitivity=.33;break;case .22:S("Mouse sensitivity set to highest."),r.mouseSensitivity=.33;break;case .11:S("Mouse sensitivity set to high."),r.mouseSensitivity=.22;break;case .05:S("Mouse sensitivity set to medium."),r.mouseSensitivity=.11;break}}),window.addEventListener("keyup",e=>Z.delete(e.code)),t.addEventListener("mousedown",e=>{e.button===0&&Je(),Yo=e.clientX,X0(),z0()}),t.addEventListener("mousemove",e=>{if(!!document.pointerLockElement||!!document.mozPointerLockElement||!!document.webkitPointerLockElement){let n=e.movementX*Math.PI*(.015*r.mouseSensitivity);r.a+=n}}),pe.onclick=()=>Go(),ue.onclick=()=>it.classList.toggle("visible")}function eo(t){let e=Z.has("ShiftLeft")||Z.has("ShiftRight"),o=r.rotSpeed*t,n=r.accel*t,s=Math.cos(r.a),i=Math.sin(r.a),a=-i,l=s;r.weaponAnim>.75&&(r.weaponAnim=-1),r.weaponAnim>=0&&(r.weaponAnim+=t);let c=3;r.velX-=r.velX*c*t,r.velY-=r.velY*c*t,Math.abs(r.velX)<.002&&(r.velX=0),Math.abs(r.velY)<.002&&(r.velY=0),r.isMoving=!1;let d=0,h=0;Z.has("ArrowLeft")&&(r.a-=o),Z.has("ArrowRight")&&(r.a+=o),(Z.has("ArrowUp")||Z.has("KeyW"))&&(d+=s*n,h+=i*n,r.isMoving=!0),(Z.has("ArrowDown")||Z.has("KeyS"))&&(d-=s*n,h-=i*n,r.isMoving=!0),Z.has("KeyA")&&(d-=a*n,h-=l*n,r.isMoving=!0),Z.has("KeyD")&&(d+=a*n,h+=l*n,r.isMoving=!0),r.velX+=d,r.velY+=h;let g=Math.hypot(r.velX,r.velY);g>20&&(r.velX*=20/g,r.velY*=20/g);let y=r.x+r.velX*t,x=r.y+r.velY*t;if(Ct(y,r.y,F0)?r.velX=0:r.x=y,Ct(r.x,x,F0)?r.velY=0:r.y=x,r.health>=0){let E=X[(r.y|0)*f.MAP_W+(r.x|0)],u=f.zones[E]?.floorDepth||0;(r._currentZoneId!==E||r._currentFloorDepth!==u)&&(r._currentZoneId=E,r._currentFloorDepth=u,Zt())}}function Je(){if(r.weaponAnim>=0)return;r.weaponAnim=0,yt(),z.shot();let t=c0(),e=No(t);!e||jt(e,t).depth>2.5||e.onHit&&e.onHit(e,!0)}function oo(){for(let t of O)!t.alive||Math.hypot(t.x-r.x,t.y-r.y)>=.6||t.onTouch&&t.onTouch(t)}function no(){if(Z0)return;let t=r.x|0,e=r.y|0;f.MAP[e][t]===5&&(z.portal(),S(`Floor ${_t} cleared.`),_0(_t+1),Z0=!0,r.velX=0,r.velY=0,setTimeout(()=>{zo(!0),Z0=!1},100))}function No(t){let o=document.getElementById("view").width>>1|0,n=tt[o]||1e9,s=null,i=1e9;for(let a of O){if(!a.alive)continue;let l=jt(a,t);l&&(r.sightDist>0&&l.depth>r.sightDist||o>=l.drawStartX&&o<l.drawEndX&&l.depth<n+.1&&l.depth<i&&(s=a,i=l.depth))}return s}function e0(t=2){let e=0;for(;e++<200;){let o=(Math.random()*(f.MAP_W-2)|0)+1,n=(Math.random()*(f.MAP_H-2)|0)+1;if(f.MAP[n][o]!==0)continue;let s=o+.5-r.x,i=n+.5-r.y;if(!(Math.hypot(s,i)<t))return{x:o,y:n}}return{x:9,y:9}}var K0=new Map;function ro(){K0.clear();let{MAP_W:t,MAP_H:e,MAP:o,zones:n}=f;for(let s=0;s<n.length;s++){let i=n[s],a=Math.min(i.x,i.x+i.w),l=Math.max(i.x,i.x+i.w)-1,c=Math.min(i.y,i.y+i.h),d=Math.max(i.y,i.y+i.h)-1,h=ct(a,0,t-1),g=ct(l,0,t-1),y=ct(c,0,e-1),x=ct(d,0,e-1),E=[];for(let u=y;u<=x;u++)for(let R=h;R<=g;R++)Rt(R,u)||E.push({x:R,y:u});K0.set(s,E)}}function Wo(t){let e=K0.get(t);return!e||e.length===0?null:Mt(e)}function $0(){let t=f.MAP_W,e=f.MAP_H;for(let o=0;o<e;o++)for(let n=0;n<t;n++)f.MAP[o][n]===7&&(f.MAP[o][n]=0)}function io(){let t=dt.x,e=dt.y;for(let o=e-1;o<=e+1;o++)for(let n=t-1;n<=t+1;n++)n===t&&o===e||(f.MAP[o][n]=7)}function so(){if(O.length=0,Q(100)<50)for(let o=0;o<Q(2)*(f.MAP_H/20|0);o++){let n=e0(1);O.push(St(M.barrel,{x:n.x+.5,y:n.y+.5}))}let t=e0(4);O.push(St(M.key,{x:t.x+.5,y:t.y+.5})),t=e0(4),O.push(St(M.food,{x:t.x+.5,y:t.y+.5}));let e=Math.min((2+(_t-1)*2)*(f.MAP_H/20|0),8);for(let o=0;o<e;o++){let n=e0(3.5);O.push(St(M.entity,{x:n.x+.5,y:n.y+.5}))}t=e0(4),O.push(St(M.ball,{x:t.x+.5,y:t.y+.5})),f.zones.forEach((o,n)=>{let s=n;o.spawnRules?.forEach(a=>{let l=Math.max(0,a.amount|0);for(let c=0;c<l;c++){let d=Wo(s);if(!d)break;O.push(St(a.entityType,{x:d.x+.5,y:d.y+.5}))}})})}function yt(){ae.style.width=`${r.health/r.maxHealth*100}%`,le.style.width=`${r.ammo/60*100}%`,ce.textContent=Math.max(0,r.health),fe.textContent=r.ammo}var j0=0,J0=0,Q0=!1,Qe=!1;function S(t){let e=document.getElementById("gameLog"),o=e?.querySelector(".log-items");if(!o)return;let n=o.firstElementChild;if(n){let i=n.innerHTML,a=i.match(/^(.*?)(?:\s+x(\d+))?$/),l=a?a[1]:i,c=a&&a[2]?parseInt(a[2]):1;if(l===t){let d=a&&a[2]?c+1:2;n.innerHTML=`${t} x${d}`;return}}let s=document.createElement("div");s.innerHTML=t,o.prepend(s),e.classList.contains("collapsed")||requestAnimationFrame(()=>{o.scrollTop=0})}function ao(t){j0>0&&(j0-=t,j0<=0&&(de.textContent=r.hasBlueKey?"Find the exit.":"Find the key card."))}function q0(){Q0||r.health<=0&&(Q0=!0,r.speed=0,r.rotSpeed=0,J0=2,S("YOU DIED! Soul disconnecting from the node..."))}function lo(t){Q0&&(J0-=t,J0<=0&&Xo())}function Xo(){if(Qe)return;Qe=!0;let t=document.getElementById("game");if(t){let e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.background="#ff0000",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="999999",e.style.fontFamily='"Courier New", monospace',e.style.opacity="0",e.style.transition="opacity 2s ease-in",e.innerHTML=`
      <div style="
        background: #000;
        border: 3px solid #04650d;
        color: #20b2db;
        width: 600px;
        max-width: 90vw;
        box-shadow: 0 0 20px #04650d;
        font-family: 'Courier New', monospace;
      ">
        <div style="
          background:#000;
          color: #04650d;
          padding: 8px 15px;
          display: flex;
          justify-content: space-between;
          font-weight: bold;
          font-size: 12px;
        ">
          <span style ="color: #FFFFFF; border: 1px solid #04650d;">Death...</span>
        </div>
        <div style="padding: 20px; min-height: 200px;">
          <div style="margin-bottom: 30px;">
            <div style="text-align: center; color: #FFFFFF; font-size: 32px; margin: 8px 0;">YOU HAVE DIED</div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="returnBtn" style="
              background: #000;
              border: 2px solid #04650d;
              color: #04650d;
              padding: 12px 24px;
              font-family: 'Courier New', monospace;
              font-size: 14px;
              font-weight: bold;
              cursor: pointer;
              text-transform: uppercase;
              letter-spacing: 1px;
            ">RETURN TO TERMINAL</button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(e);let o=e.querySelector("#returnBtn");if(o){let n=!1;o.addEventListener("click",s=>{s.preventDefault(),!n&&(n=!0,setTimeout(()=>{window.location.href="../index.html"},100))})}setTimeout(()=>{e.style.opacity="1"},50),t.classList.add("game-paused"),Z.clear()}}function te(t=!1){t&&Wt(),r.x=At.x,r.y=At.y,r.a=0,r.hasBlueKey=!1,f.MAP[dt.y][dt.x]=5,io(),so(),yt(),S(`Floor ${_t}: Find the keycard.`)}function zo(t=!1){t&&(U0>=$t.length-1?Wt():(U0+=1,Wt(U0))),r.x=At.x,r.y=At.y,r.a=0,r.hasBlueKey=!1,f.MAP[dt.y][dt.x]=5,io(),so(),yt(),S(`Floor ${_t}: Find the keycard.`)}function Go(){_0(1),Wt(0),te()}function co(t){for(let e of O)e.alive&&e.ai&&e.ai(e,t)}var w0=performance.now(),E0=new Map;function y0(t,e=0){if(e===0)return!(w0<E0.get(t));let o=w0,n=E0.get(t)??0;return o<n?!1:(E0.set(t,o+e),!0)}function ii(t){E0.set(t,performance.now())}var ee=m>>1;to(Lt);var x0=0;function Vo(t){let e=`FPS: ${Math.round(t)}`;p.save(),p.font="12px monospace",p.textAlign="right",p.textBaseline="top";let o=F-8,n=6,s=p.measureText(e).width+8,i=16;p.fillStyle="rgba(10, 15, 25, 0.6)",p.fillRect(o-s,n-2,s,i),p.strokeStyle="rgba(60, 80, 130, 0.9)",p.strokeRect(o-s+.5,n-2+.5,s-1,i-1),p.fillStyle="#dfe6ff",p.fillText(e,o,n),p.restore()}function Wt(t=-1){let e;if(t!==-1){let o=$t[t];o&&(e=o.dontPersist?JSON.parse(JSON.stringify(o)):o)}else{let o=Mt($t);o&&(e=o.dontPersist?JSON.parse(JSON.stringify(o)):o)}dt.x=e.exitPos.x,dt.y=e.exitPos.y,At.x=e.startPos.x,At.y=e.startPos.y,r.sightDist=e.sightDist||xe,f.cielingColorFront=e.cielingColorFront||"#6495ED",f.floorColorFront=e.floorColorFront||"#054213",f.cielingColorBack=e.cielingColorBack||"#6495ED",f.floorColorBack=e.floorColorBack||"#03210A",f.MAP=e.mapLayout,f.MAP_W=f.MAP[0].length,f.MAP_H=f.MAP.length,f.zones=e.zones,ro(),ve(),Ie(),Zt(),r.x=r.x=e.startPos.x,r.y=e.startPos.y}async function $o(){await Ne(),await Ce(),Wt(0),te(),r.maxHealth=20+Q(6),r.health=r.maxHealth,r.ammo=5+Q(5),yt(),requestAnimationFrame(fo)}function qo(t){let e=c0();if(f.zones.length<=2)Re(p);else{for(let o=0;o<F;o++)Oe(t,e,o,0);Be(p)}if(f.zones.length<=2){let o=r.x|0,n=r.y|0,s=X[n*f.MAP_W+o],i=g0[s];if(!i){let a=f.zones[s].fogColor;i=p.createLinearGradient(0,m,0,ee),i.addColorStop(0,f.floorColorFront||"#054213"),i.addColorStop(.85,f.floorColorBack||"#03210A"),i.addColorStop(.95,a||ft),g0[s]=i}p.fillStyle=i,p.fillRect(0,ee,F,ee)}else{for(let o=0;o<F;o++)Pe(t,e,o,0);He(p)}Le(p),Ye(t,e,f.MAP,f.MAP_W,f.MAP_H),Uo(),O.sort((o,n)=>n.dist-o.dist),Zo(e),Jo(t),je(p,e,F,m,r)}function Uo(){for(let t of O){let e=t.x-r.x,o=t.y-r.y;t.dist=e*e+o*o}}function Zo(t){p.save();for(let e of O){if(!e.alive||Math.hypot(e.x-r.x,e.y-r.y)>r.sightDist)continue;let n=jt(e,t);if(!n||r.sightDist>0&&n.depth>r.sightDist)continue;let s=3,i=0;for(let l=0;l<s;l++){let c=n.drawStartX+l*(n.drawEndX-n.drawStartX)/(s-1);n.depth<=tt[Math.floor(c)]&&i++}if(i===0)continue;let a=jo(n);Ko(e,n,a),p.filter="none"}p.restore()}function jo(t){let e=1/(1+t.depth*.3);if(r.sightDist>0&&t.depth>r.sightDist*Ht){let s=r.sightDist*Ht,i=Math.min(1,Math.max(0,(t.depth-s)/Math.max(1e-6,r.sightDist-s)));e*=1-i*.6}let o=[1,.85,.7,.55,.4];return{quantizedShade:o.reduce((s,i)=>Math.abs(i-e)<Math.abs(s-e)?i:s,o[0])}}function Ko(t,e,o){o.quantizedShade<.999&&(p.filter=`brightness(${o.quantizedShade})`);let n=Math.max(1,(e.width??e.drawEndX-e.drawStartX)|0),s=e.drawStartY,i=e.drawEndY-e.drawStartY,a=e.occludedBottom|0;if(a>=i){p.filter="none";return}let l=i-a,c=k[t.img];if(!c){p.filter="none";return}let d=a/i,h=Math.round(c.height*d),g=c.height-h,y=u=>(u-e.drawStartX)*k[t.img].width/n|0,x=-1,E=0;for(let u=e.drawStartX;u<=e.drawEndX;u++){let W=u>=0&&u<F&&u<e.drawEndX&&e.depth<=tt[u];if(W&&x===-1&&(x=u,E=y(u)),(!W||u===e.drawEndX)&&x!==-1){let w=u,_=w-x,L=y(w);L<=E&&(L=E+1);let A=Math.min(k[t.img].width-E,L-E);_>0&&A>0&&i>0&&p.drawImage(k[t.img],E,0,A,g,x,s,_,l),x=-1}}}function Jo(t){if(!k.pitchfork)return;let e=Math.round(F*.42),o=Math.round(e*(k.pitchfork.height/k.pitchfork.width)),n=r.isMoving&&r.weaponAnim<0?10*Math.sin(t*5):0,s=Math.max(8,F*.02|0),i=F*.5-e/2-s/2+n,a=(r.weaponAnim+1)**10,l=a>7?7:a,c=r.weaponAnim>=0?100-l*20:0,d=r.isMoving&&r.weaponAnim<0?10*Math.sin(t*10):0,h=m-o-s+70+d+c;p.drawImage(k.pitchfork,i,h,e,o)}function fo(t){let e=Math.min(.05,(t-w0)/1e3);w0=t;let o=e>0?1/e:0;x0=x0?x0*.9+o*.1:o,eo(e),co(e),Ze(e),oo(),qo(t/1e3),it.classList.contains("visible")&&ze(O),no(),ao(e),lo(e),Vo(x0),C0.drawImage(A0,0,0),requestAnimationFrame(fo)}await $o().catch(console.error);export{Wt as ChangeMapLevel,ii as resetCooldown,y0 as tryCooldown};
