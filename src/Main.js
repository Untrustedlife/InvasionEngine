import{a as at,b as se,c as M}from"../chunks/chunk-75YVQ3JR.js";var zt=document.getElementById("view");zt.width=480;zt.height=270;var F=480,m=270,A0=new OffscreenCanvas(F,m),u=A0.getContext("2d");u.imageSmoothingEnabled=!1;var C0=zt.getContext("2d");C0.imageSmoothingEnabled=!1;var nt=document.getElementById("mini"),Y=nt.getContext("2d");Y.imageSmoothingEnabled=!1;var ae=document.getElementById("hpBar"),le=document.getElementById("ammoBar"),ce=document.getElementById("hpText"),fe=document.getElementById("ammoText"),de=document.getElementById("msg"),ue=document.getElementById("btnReset"),pe=document.getElementById("btnToggleMap");var mo=90*Math.PI/180,T0=mo*.5,b0=.01,D0=.01,xe=15;var Ht=.6,lt="#101b2e";var r={x:3.5,y:3.5,velX:0,velY:0,a:0,accel:10,rotSpeed:2.6,health:6,maxHealth:20,ammo:1,hasBlueKey:!1,isMoving:!1,weaponAnim:-1,tenacity:20,maxTenacity:20,height:.75,sightDist:15,mouseSensitivity:.22,height:1.2,calculatePlayerHeight:()=>{if(2-r.height<.01)return .01;let t=r.getCurrentFloorDepth?r.getCurrentFloorDepth():0;return(2-r.height-t)*1},getCurrentZoneId:()=>r._currentZoneId||0,getCurrentFloorDepth:()=>r._currentFloorDepth||0,_currentZoneId:0,_currentFloorDepth:0},F0=.2,kt=1,Ee=1,ho=99;function _0(t){kt=Math.max(Ee,Math.min(ho,t|0||Ee))}function l0(){let t=Math.cos(r.a),e=Math.sin(r.a),o=-e*Math.tan(T0),n=t*Math.tan(T0),s=1/(o*e-t*n);return{dirX:t,dirY:e,planeX:o,planeY:n,invDet:s}}var we=[{index:1,image:"OfficeWall.png"},{index:2,image:"Panel.png"},{index:3,image:"Hedge.png"},{index:4,image:"OfficeDoor.png"},{index:5,image:"Portal.png"},{index:6,image:"OfficeDoorBlue.png"},{index:7,image:"Field.png"},{index:8,image:"OfficeWall.png"},{index:9,image:"OfficeDoorBlue.png"}],Me={0:0,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:3,9:3};function go(t=64,e=64){return new OffscreenCanvas(t,e)}var rt=new Array(8).fill(null);function Ae(t){let o=t.getContext("2d").getImageData(0,0,t.width,t.height),n=[];for(let s=0;s<t.width;s++){let i=new Uint8ClampedArray(t.height*4);for(let a=0;a<t.height;a++){let l=(a*t.width+s)*4,c=a*4;i[c]=o.data[l],i[c+1]=o.data[l+1],i[c+2]=o.data[l+2],i[c+3]=o.data[l+3]}n.push({data:i,h:t.height})}return{cols:n,w:t.width,h:t.height}}var Gt=rt.map(t=>t?Ae(t):null);function yo(){Gt.length=0,rt.forEach(t=>{Gt.push(t?Ae(t):null)})}var f0=Array.from({length:82},(t,e)=>e*.0125),c0={};function xo(){for(let t=1;t<rt.length;t++)if(rt[t]){c0[t]={};for(let e of f0){let o=new OffscreenCanvas(rt[t].width,rt[t].height),n=o.getContext("2d");n.drawImage(rt[t],0,0);let s=e*255|0;n.globalCompositeOperation="multiply",n.fillStyle=`rgb(${s},${s},${s})`,n.fillRect(0,0,o.width,o.height),c0[t][e]=o}}}async function Eo(t){let e=`../assets/gfx/${t}`;return new Promise((o,n)=>{let s=new Image;s.onload=()=>{let i=go(64,64),a=i.getContext("2d",{willReadFrequently:!0});a.imageSmoothingEnabled=!1,a.drawImage(s,0,0,64,64),o(i)},s.onerror=()=>n(new Error(`Failed to load texture: ${e}`)),s.src=e})}async function Ce(){try{await wo(we),yo(),xo()}catch(t){console.warn("Failed to init wall textures:",t)}}async function wo(t){if(!Array.isArray(t)){console.warn("Expected an array of { index, image } objects. In loadImagesToReplaceTextures");return}let e=t.map(async(o,n)=>{let{index:s,image:i}=o||{};try{let a=await Eo(i);return s&&s>=0&&(rt[s]=a),a}catch(a){return console.warn(`Failed to load texture "${i}" for index ${s} and dont support replacing with cool gmod missing texture:`,a),null}});await Promise.all(e)}var Se=[{name:"Village",mapLayout:[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,8,8,8,8,8,9,8,8,9,8,8,8,8,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],exitPos:{x:14,y:14},startPos:{x:9.5,y:1.5},zones:[{color:"#054213",x:0,y:0,w:1,h:1,floorColorBack:"#101b2e",cielingColorFront:"#6495ed",fogColor:"#101b2e",spawnRules:[]},{color:"#0011ff",x:0,y:2,w:20,h:2,cielingColorFront:"#6495ed",cielingColorBack:"#00000000",floorColorBack:"#03210a",fogColor:"#101b2e",spawnRules:[],floorDepth:-.5},{color:"#8b8000",x:3,y:5,w:14,h:12,cielingColorFront:"#8b8000",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",ceilingHeight:6,spawnRules:[{entityType:"entity",amount:5},{entityType:"barrel",amount:5},{entityType:"food",amount:2}]},{color:"#054213",x:1,y:0,w:18,h:19,cielingColorFront:"#6495ed",cielingColorBack:"#00000000",floorColorBack:"#03210a",fogColor:"#101b2e",spawnRules:[]}]},{name:"TowerFloor1",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,6,1,1,1,1,0,0,1,6,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,6,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,1,1,1,1,1,1,0,0,0,1,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1]],exitPos:{x:10,y:17},startPos:{x:5.5,y:4.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000",zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]},{name:"Gallery",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,0,0,0,3,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,1],[1,1,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,1,7,1,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,6],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[4,0,2,2,2,2,2,2,2,2,2,0,6,0,6,0,6,0,6,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,3,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],exitPos:{x:3,y:3},startPos:{x:1.5,y:21.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#ECDE60",floorColorBack:"#000000",sightDist:10,zones:[{color:"#888000",cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",x:0,y:0,w:0,h:0,spawnRules:[]},{color:"#888000",x:2,y:2,w:4,h:7,cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",spawnRules:[]},{color:"#888000",x:6,y:2,w:12,h:7,cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",spawnRules:[{entityType:"ball",amount:2},{entityType:"food",amount:1}]}]},{name:"LongHallways",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,3,3,3,3,0,4,0,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,1,6,1,1,1,6,1,1,1,6,1,1,1,6,1,1,0,0,3,3,3,3,3,0,0,0,3,3,3,3,3,0,0,1,1,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,6,0,1],[1,7,7,1,1,6,1,1,1,1,1,1,1,1,1,1,1,6,1,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,0,3,3,3,3,3,0,3,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,3,3,3,3,0,3,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,0,0,0,3,3,3,0,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,0,0,0,0,3,3,0,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,1,1,1],[1,7,7,1,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,4,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0,0,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],sightDist:10,exitPos:{x:1,y:1},startPos:{x:9.5,y:3.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000",zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]}];function Et(t){if(!Array.isArray(t)||t.length===0)throw new Error("Array must be non-empty.");let e=K(t.length)-1;return t[e]}function K(t){if(t<=0)throw new Error("The maximum value must be greater than 0.");return Math.floor(Math.random()*t)+1}function d0(t,e,o){return t+(e-t)*o}function Te(t,e){let o=t?t.length:0;if(o===0)return-1;if(e<=t[0])return 0;if(e>=t[o-1])return o-1;let n=0,s=o-1;for(;n<=s;){let i=n+s>>1,a=t[i];if(a===e)return i;a<e?n=i+1:s=i-1}return e-t[s]<=t[n]-e?s:n}function k0(t){let e=t.charCodeAt(0)===35?t.slice(1):t,o=parseInt(e.length===3?e.split("").map(n=>n+n).join(""):e,16);return[o>>16&255,o>>8&255,o&255]}var ct={x:10,y:8},wt={x:3.5,y:3.5};var f={MAP:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,2,6,2,0,0,0,0,0,0,0,2,6,2,0,0,1],[1,0,0,0,2,0,2,0,0,0,0,0,0,0,2,0,2,0,0,1],[1,0,0,0,2,2,2,0,0,0,0,0,0,0,2,2,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,5,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,3,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,3,3,1,3,3,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,0,0,0,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,2,2,2,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,1,0,2,0,2,0,1,0,3,0,0,0,1],[1,0,0,0,0,0,0,0,0,2,6,2,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],MAP_W:-1,MAP_H:-1,cielingColorFront:"",floorColorFront:"",cielingColorBack:"",floorColorBack:"",dontPersist:!1,sightDist:15,zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]},Vt=Se,be=new Map;function Fe(t){let e=f.zones,o=e&&e[t]?.color||lt,n=be.get(o);return n||(n=k0(o),be.set(o,n)),n}var De=new Map;function _e(t){let e=f.zones,o=e&&e[t]?.cielingColorFront||lt,n=De.get(o);return n||(n=k0(o),De.set(o,n)),n}function ke(t,e,o){for(let n=0;n<o.length;n++){let s=o[n],i=Math.min(s.x,s.x+s.w),a=Math.max(s.x,s.x+s.w)-1,l=Math.min(s.y,s.y+s.h),c=Math.max(s.y,s.y+s.h)-1;if(t>=i&&t<=a&&e>=l&&e<=c)return n}return 0}var J=new Float32Array(F),H=m>>1,qt=new Int16Array(F).fill(H),m0=new Int16Array(F).fill(H),Bt=new Float32Array(m),I0=new Float32Array(m),u0={},Yt={};function Ut(){for(let i in Yt)delete Yt[i];for(let i in u0)delete u0[i];let t=H,e=r.calculatePlayerHeight(),n=2-0,s=m*(n-e)*.5;for(let i=0;i<m;i++){let a=i-t;Bt[i]=a!==0?s/a:1e-6;let c=2-2,d=m*(c+e)*.5;I0[i]=a!==0?-d/a:-1e-6}for(let i=0;i<f.zones.length;i++){let a=f.zones[i];if(a.ceilingHeight!==void 0){Yt[i]=new Float32Array(m);for(let l=0;l<m;l++){let c=l-t,h=a.ceilingHeight-2,g=m*(h+e)*.5;Yt[i][l]=c!==0?-g/c:-1e-6}}if(a.floorDepth!==void 0){let c=2-a.floorDepth,d=m*(c-e)*.5;u0[i]=new Float32Array(m);for(let h=0;h<m;h++){let g=h-t;u0[i][h]=g!==0?d/g:1e-6}}}}Ut();var R0=[],P0=[],O0=[],h0=[],X=[],L0=[];function ve(){R0.length=0,P0.length=0,O0.length=0,h0.length=0,L0.length=0,H0.clear(),B0.clear()}function $t(t,e,o,n,s,i,a,l,c,d){if(!s)return;let h=n-o;if(h<=0)return;let g=l||0,y=g<0?0:g>s.height?s.height:g,x=c||s.height,E=s.height-y,p=x<0?0:x>E?E:x,I=Te(f0,a);t.drawImage(c0[d][f0[I]],i,y,1,p,e,o,1,h)}function Ie(t){let e=r.x|0,o=r.y|0,n=X[o*f.MAP_W+e],s=R0[n];if(!s){s=t.createLinearGradient(0,0,0,H);let i=f.zones[n].cielingColorFront,a=f.zones[n].cielingColorBack,l=f.zones[n].fogColor;s.addColorStop(0,i||f.cielingColorFront||"#6495ED"),f.cielingColorBack&&s.addColorStop(.5,a||f.cielingColorBack||"#6495ED"),s.addColorStop(.9,l||lt),R0[n]=s}t.fillStyle=s,t.fillRect(0,0,F,H)}var H0=new Map;function v0(t){let e=H0.get(t);if(!e){let[o,n,s]=Fe(t);e=`rgb(${o|0},${n|0},${s|0})`,H0.set(t,e)}return e}var B0=new Map;function p0(t){let e=B0.get(t);if(!e){let[o,n,s]=_e(t);e=`rgb(${o|0},${n|0},${s|0})`,B0.set(t,e)}return e}function Re(){X.length=0;let t=f.zones,e=f.MAP_W,o=f.MAP_H;for(let n=0;n<o;n++)for(let s=0;s<e;s++)X[n*e+s]=ke(s,n,t)}function Pe(t,e,o,n=0){let{dirX:s,dirY:i,planeX:a,planeY:l}=e;n=qt[o]??H;let c=n<H?H:n;if(c>=m)return;let d=2*(o+.5)/F-1,h=s+a*d,g=i+l*d;if(r.sightDist>0){let T=J[o]??1/0;for(;c<m;){let C=Bt[c]??1/0;if(C<=r.sightDist&&C<=T)break;c++}if(c>=m)return}let y="#000000",x=f.MAP_W,E=f.MAP_H,p=1/(s*h+i*g),I=h*p,N=g*p,w=0;function _(T,C=0){let G=Bt[T]??Bt[Bt.length-1]??1/0,z=r.x+I*G,b=r.y+N*G,D=z|0,tt=b|0;return D>=0&&tt>=0&&D<x&&tt<E?X[tt*x+D]:0}let L=T=>Math.max(8,Math.min(64,8+(T-H>>>3)));w=_(c,w);let A=c,R=null;for(;c<m;){let T=Math.min(L(c),m-1-c);if(T<=0)break;let C=c+T;if(_(C,w)===w){let U=c+C>>1;if(_(U,w)===w){let P=v0(w);P!==R&&(u.fillStyle=P,R=P);let et=C+1-A;et>0&&u.fillRect(o,A,1,et),c=C+1,A=c;continue}}let z=c,b=C;for(;b-z>1;){let U=z+b>>1;_(U,w)===w?z=U:b=U}let D=v0(w);D!==R&&(u.fillStyle=D,R=D);let tt=b-A;tt>0&&u.fillRect(o,A,1,tt);let ut=_(b,w),Pt=f.zones[w]?.floorDepth??0,e0=f.zones[ut]?.floorDepth??0,o0=qt[o]??H,n0=Bt[b]??1/0,r0=J[o]??1/0,i0=b===o0,s0=n0>=r0-.11;if(!!y&&Pt!==e0&&!i0&&!s0&&!(A===o0)){let U=Pt>e0?5:1,P=b,et=Math.min(m,P+U);et>P&&(u.fillStyle!==y&&(u.fillStyle=y),u.fillRect(o,P,1,et-P)),R=null,w=ut,c=et,A=c;continue}w=ut,c=b,A=c}if(A<m){let T=v0(w);T!==R&&(u.fillStyle=T),u.fillRect(o,A,1,m-A)}}function Oe(t,e,o,n=0){let{dirX:s,dirY:i,planeX:a,planeY:l}=e,c=m0[o]??H,d=0;if(c<=0)return;let h=2*(o+.5)/F-1,g=s+a*h,y=i+l*h,x=1/(s*g+i*y),E=0,p=Yt?.[E]?.[d]??I0[d],I=r.x+g*p*x,N=r.y+y*p*x,w=d,_=null;for(let A=d;A<c;A++){if(r.sightDist>0&&Math.abs(p)>r.sightDist){let b=p0(E);b!==_&&(u.fillStyle=b),u.fillRect(o,w,1,A-w);return}if(p>J[o]){let b=p0(E);b!==_&&(u.fillStyle=b),u.fillRect(o,w,1,A-w);return}let R=I|0,T=N|0,C=R>=0&&T>=0&&R<f.MAP_W&&T<f.MAP_H?X[T*f.MAP_W+R]:E;if(C!==E){let b=p0(E);b!==_&&(u.fillStyle=b,_=b),u.fillRect(o,w,1,A-w),E=C,w=A}let G=Yt?.[E]?.[A+1]??I0[A+1]??p,z=G-p;I+=g*z*x,N+=y*z*x,p=G}let L=p0(E);L!==_&&(u.fillStyle=L),u.fillRect(o,w,1,c-w)}function Le(t){let e=O0[0];e||(e=t.createLinearGradient(0,0,0,m),e.addColorStop(0,"rgba(16,27,46,0.08)"),e.addColorStop(.5,"rgba(16,27,46,0.16)"),e.addColorStop(1,"rgba(16,27,46,0.20)"),O0[0]=e),t.fillStyle=e,t.fillRect(0,0,F,m)}function He(t){let e=H-1,o=m-e,n=r.x|0,s=r.y|0,i=X[s*f.MAP_W+n],a=P0[i];if(!a){let l=f.zones[i].floorColorBack;a=t.createLinearGradient(0,e,0,m),a.addColorStop(.05,f.zones[i].fogColor||lt),a.addColorStop(.15,l||f.floorColorBack||"#03210A"),a.addColorStop(1,"rgba(0,0,0,0)"),P0[i]=a}t.fillStyle=a,t.fillRect(0,e,F,o)}function Be(t){let o=H+1,n=r.x|0,s=r.y|0,i=X[s*f.MAP_W+n],a=L0[i];if(!a){let l=f.zones[i].fogColor||lt,c=f.zones[i].cielingColorBack||f.cielingColorBack||"#6495ED";a=t.createLinearGradient(0,0,0,0+o),a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(.85,c),a.addColorStop(.95,l),L0[i]=a}t.fillStyle=a,t.fillRect(0,0,F,o)}function Ye(t,e,o,n,s){let{dirX:i,dirY:a,planeX:l,planeY:c}=e;for(let d=0;d<F;d++){let h=2*(d+.5)/F-1,g=i+l*h,y=a+c*h;if(g<1e-8&&g>-1e-8&&y<1e-8&&y>-1e-8){J[d]=Number.POSITIVE_INFINITY,qt[d]=H,m0[d]=H;continue}let x=1/(g||1e-9),E=1/(y||1e-9),p=r.x|0,I=r.y|0,N=x<0?-x:x,w=E<0?-E:E,_,L,A,R;g<0?(_=-1,A=(r.x-p)*N):(_=1,A=(p+1-r.x)*N),y<0?(L=-1,R=(r.y-I)*w):(L=1,R=(I+1-r.y)*w);let T=0,C=1,G=!1,z=0,b=0;for(;!G&&z++<256;){if(A<R?(A+=N,p+=_,T=0):(R+=w,I+=L,T=1),r.sightDist>0){let Z=Math.min(A,R);if(Z>r.sightDist){G=!1,C=0,b=Z;break}}if(p<0||I<0||p>=n||I>=s){G=!0,C=1;break}let B=o[I][p];if(B>0){G=!0,C=B;break}}if(C===0){J[d]=Number.POSITIVE_INFINITY,qt[d]=H,m0[d]=H;continue}let D;T===0?D=A-N:D=R-w,D=b0>D?b0:D;let tt=0,ut=T===0?_:0,Pt=T===1?L:0,i0=Math.abs(ut*i+Pt*a)>=.9&&Math.abs(h)<=.9&&D<tt?tt:D,s0=r.x+i0*g,w0=r.y+i0*y,ht;T===0?ht=w0-(w0|0):ht=s0-(s0|0),ht=ht<0?0:ht>.999999?.999999:ht+1e-6;let U=Gt[C]||Gt[4],P=rt[C],et=P?P.width|0:U.w|0,ot=ht*et|0;(T===0&&_>0||T===1&&L<0)&&(ot=et-ot-1),ot=ot<0?0:ot>=et?et-1:ot;let uo=D<D0?D0:D,Ct=m/uo|0,Wt=(m-Ct*r.calculatePlayerHeight())/2|0,M0=Wt+Ct,pt=Wt,St=M0;pt<0&&(pt=0),St>m&&(St=m);let oe=St-pt;qt[d]=St;let Tt=Me[C]||1;if(m0[d]=pt*Tt,oe<=0){J[d]=D;continue}let ne=(P?P.height:U.h||rt[C]?.height||64)|0,re=(pt-Wt)*(ne/(Ct>1?Ct:1)),ie=oe*(ne/Math.max(1,Ct)),Ot=1/(1+D*.25)*(T?.5:1);if(C===7&&(Ot*=.8+.2*Math.sin(t*6+d*.05)),Tt==1)$t(u,d,pt,St,P,ot,Ot,re,ie,C);else if(Tt>1){$t(u,d,pt,St,P,ot,Ot,re,ie,C);let B=Ct,Z=(P?.height||U.h||64)|0,it=Z/Math.max(1,B),gt=Math.floor(Tt)-1;for(let j=0;j<gt;j++){let yt=Wt-B*(j+1),bt=M0-B*(j+1),st=Math.max(0,Math.ceil(yt)),xt=Math.min(m,Math.floor(bt)),Dt=xt-st;if(Dt<=0)continue;let Ft=(st-yt)*it,_t=Dt*it;$t(u,d,st,xt,P,ot,Ot,Ft,_t,1)}let Lt=Tt-(1+gt);if(Lt>1e-6){let j=B*Lt,yt=Wt-B*gt,bt=yt-j,st=Math.max(0,Math.ceil(bt)),xt=Math.min(m,Math.floor(yt)),Dt=xt-st;if(Dt>0){let Ft=yt-B,_t=(st-Ft)*it%Z;_t<0&&(_t+=Z);let po=Dt*it;$t(u,d,st,xt,P,ot,Ot,_t,po,1)}}}else if(Tt<1){let B=Ct,Z=(P?.height||U.h||64)|0,it=Z/Math.max(1,B),gt=Tt;if(gt>1e-6){let Lt=B*gt,j=M0,yt=j-Lt,bt=Math.max(0,Math.ceil(yt)),st=Math.min(m,Math.floor(j)),xt=st-bt;if(xt>0){let Dt=j-B,Ft=(bt-Dt)*it%Z;Ft<0&&(Ft+=Z);let _t=xt*it;$t(u,d,bt,st,P,ot,Ot,Ft,_t,C)}}}if(r.sightDist>0&&D>r.sightDist*Ht){let B=r.sightDist*Ht,Z=r.sightDist,it=Math.min(1,Math.max(0,(D-B)/Math.max(1e-6,Z-B)));if(it>0){let gt=r.x|0,Lt=r.y|0,j=X.length>0?X[Lt*f.MAP_W+gt]:0;u.save(),u.globalAlpha=it*.85,u.fillStyle=f.zones[j].fogColor||lt,u.fillRect(d,pt,1,St-pt),u.restore()}}J[d]=D}}var k={aiDrone1:null,ball:null,sparkle:null,barrel:null,food:null,keycard1:null,aiDrone2:null,aiDrone3:null,pitchfork:null,bow:null};async function ft(t,e){return await Mo(t,e,1)}async function Mo(t,e=1,o=1){let n=`../assets/gfx/${t}`;return new Promise((s,i)=>{let a=new Image;a.onload=()=>{let l=new OffscreenCanvas(a.width*e,a.height*e),c=l.getContext("2d");c.imageSmoothingEnabled=!1,c.drawImage(a,0,0,l.width,l.height),l.baseline=o,l.scale=e,s(l)},a.onerror=()=>i(new Error(`Failed to load sprite: ${n}`)),a.src=n})}async function Ne(){k.food=await ft("noodles.png",3),k.bow=await ft("bow.png",3),k.pitchfork=await ft("pitchfork.png",3),k.keycard1=await ft("keycard1.png",3),k.barrel=await ft("emp.png",3),k.aiDrone1=await ft("aiDrone1.png",3),k.aiDrone2=await ft("aiDrone2.png",3),k.aiDrone3=await ft("aiDrone3.png",3),k.ball=await ft("Palantrash1.png",3),k.sparkle=await ft("sparkle.png",3)}var O=[];function Ao(t){return m/t}function Co(t,e,o){let{dirY:n,dirX:s,planeY:i,planeX:a,invDet:l}=o,c=l*(n*t-s*e),d=l*(-i*t+a*e);return{transX:c,transY:d}}function So(t,e){return Math.round((F>>1)*(1+t/e))}function Zt(t,e){let o=t.x-r.x,n=t.y-r.y,{transX:s,transY:i}=Co(o,n,e);if(i<=.01)return null;let a=So(s,i),l=t&&typeof t.scale=="number"?t.scale:t&&k[t.img]&&typeof k[t.img].scale=="number"?k[t.img].scale:1,c=Ao(i)*l,d=typeof t._hR=="number"?t._hR:Math.round(c),h=.1,g=d;(c>d+h||c<d-h)&&(g=Math.round(c)),t._hR=g;let y=g,x=k[t.img],E=x&&x.width&&x.height?x.width/x.height:1,p=Math.max(1,Math.round(y*E)),I=r.calculatePlayerHeight(),N=m*.5,w=0,_,L;if(t.ground){let C=t.floorBiasFrac??.04,G=X[(t.y|0)*f.MAP_W+(t.x|0)],z=f.zones[G],b=2-(z.floorDepth||0),D=N+m*(b-I)/(2*i)-C*y,tt=D-y;if(_=Math.round(tt),L=Math.round(D),z){let ut=z.floorDepth??0;if(ut<0){let Pt=ut<0?-ut:0,n0=at(Pt/1.2,0,1),r0=at(n0,0,1);w=Math.min(y-1,Math.round(y*r0))}}}else{let C=Math.round(N-y*.5);_=C,L=C+y}let A={startY:_,endY:L},R=Math.round(a-(p>>1)),T=R+p;return{drawStartX:R,drawEndX:T,drawStartY:A.startY,drawEndY:A.endY,depth:i,size:y,width:T-R,occludedBottom:w}}var Xe={0:"#0c1220",1:"#ECDE60",2:"#707a88",3:"#00e676",4:"#996633",5:"#FFE300",6:" #3561ff",7:"#00FFFF"},Y0={[M.entity]:"#ffeb9c",[M.barrel]:"#CD1C18",[M.key]:"#6aa2ff",[M.food]:"#7fffd4",default:"#ffffff"};var Q=6,vt=20,dt=2,We=Math.floor(vt/2);nt.width=dt+vt*Q+dt;nt.height=dt+vt*Q+dt;function ze(t){Y.clearRect(0,0,nt.width,nt.height);let e=Math.max(0,Math.min((r.x|0)-We,f.MAP_W-vt)),o=Math.max(0,Math.min((r.y|0)-We,f.MAP_H-vt));for(let l=0;l<vt;l++)for(let c=0;c<vt;c++){let d=o+l,h=e+c,g=f.MAP[d]?.[h]??0,y=Xe[g]||"#000000";Y.fillStyle=y,Y.fillRect(dt+c*Q,dt+l*Q,Q-1,Q-1)}for(let l of t){if(!l.alive)continue;let c=dt+(l.x-e)*Q,d=dt+(l.y-o)*Q;Y.fillStyle=Y0[l.type]||Y0.default,Y.fillRect(c-2,d-2,4,4)}let n=dt+(r.x-e)*Q,s=dt+(r.y-o)*Q;Y.fillStyle="#e7f3ff",Y.beginPath(),Y.arc(n,s,2.5,0,se),Y.fill();let i=Math.cos(r.a),a=Math.sin(r.a);Y.strokeStyle="#78f3d3",Y.beginPath(),Y.moveTo(n,s),Y.lineTo(n+i*1.5*Q,s+a*1.5*Q),Y.stroke()}var v=null,It=null,$=null,N0=null,Ge=null;function W0(){v||(v=new(window.AudioContext||window.webkitAudioContext))}function V({freq:t=440,dur:e=.1,type:o="square",vol:n=.2,slide:s=0}){if(!v)return;let i=v.createOscillator(),a=v.createGain();i.type=o,i.frequency.value=t,a.gain.value=n,i.connect(a).connect(v.destination);let l=v.currentTime;s&&(i.frequency.setValueAtTime(t,l),i.frequency.linearRampToValueAtTime(t+s,l+e)),a.gain.setValueAtTime(n,l),a.gain.exponentialRampToValueAtTime(.001,l+e),i.start(l),i.stop(l+e)}function X0({dur:t=.2,vol:e=.2,lp:o=1200}){if(!v)return;let n=v.createBuffer(1,v.sampleRate*t,v.sampleRate),s=n.getChannelData(0);for(let d=0;d<s.length;d++)s[d]=Math.random()*2-1;let i=v.createBufferSource(),a=v.createGain(),l=v.createBiquadFilter();i.buffer=n,a.gain.value=e,l.type="lowpass",l.frequency.value=o,i.connect(l).connect(a).connect(v.destination);let c=v.currentTime;i.start(c),i.stop(c+t)}var W={shot:()=>{let t=K(50),e=-K(50);V({freq:220+t+e,dur:.05+K(3)/100,type:"square",vol:.25,slide:120}),X0({dur:.03+K(3)/100,vol:.15,lp:800})},pickup:()=>{V({freq:880,dur:.06,type:"triangle",vol:.2}),V({freq:1180,dur:.08,type:"triangle",vol:.18})},explode:()=>{X0({dur:1,vol:.3,lp:800}),V({freq:90,dur:.7,type:"sawtooth",vol:.12,slide:-60})},hurt:()=>{V({freq:140,dur:.12,type:"sawtooth",vol:.2,slide:-50})},killedEntity:()=>{let t=Math.random()*16-8;V({freq:320+t,dur:.26,type:"triangle",vol:.3,slide:-220}),V({freq:480+t,dur:.22,type:"sawtooth",vol:.1,slide:-260}),V({freq:90,dur:.08,type:"sine",vol:.18}),X0({dur:.05,vol:.1,lp:1e3}),setTimeout(()=>{V({freq:170+t,dur:.07,type:"triangle",vol:.16,slide:70})},90)},door:()=>{V({freq:420,dur:.12,type:"square",vol:.15})},portal:()=>{V({freq:600,dur:.5,type:"sawtooth",vol:.2}),V({freq:400,dur:.3,type:"sawtooth",vol:.2,slide:50}),V({freq:600,dur:.5,type:"sawtooth",vol:.2})}};async function To(t,{volume:e=.15}={}){if(v)try{if(!N0||t!==Ge){let n=await(await fetch(t,{cache:"force-cache"})).arrayBuffer();N0=await v.decodeAudioData(n),Ge=t}Ve(),$=v.createBufferSource(),$.buffer=N0,$.loop=!0,It=v.createGain(),It.gain.value=e,$.connect(It).connect(v.destination),$.start()}catch(o){try{Ve();let n=new Audio(t);n.loop=!0,n.volume=Math.max(0,Math.min(1,e)),await n.play(),$={stop:()=>n.pause(),disconnect:()=>{}},It=null}catch(n){}}}function Ve(){try{$&&$.stop(0)}catch(t){}if($&&$.disconnect)try{$.disconnect()}catch(t){}if(It)try{It.disconnect()}catch(t){}$=null,It=null}var $e=!1;async function z0(){if(!v||$||$e)return;$e=!0,await To("../assets/sfx/HexenST02SLowed.ogg",{volume:.12})}function Rt(t,e){if(t<0||e<0||t>=f.MAP_W||e>=f.MAP_H)return!0;let o=f.MAP[e|0][t|0];return o===0||o===5?!1:o===7?!r.hasBlueKey:!(o===6||o===9)}function Mt(t,e,o){return!!(Rt(t,e)||Rt(t-o,e)||Rt(t+o,e)||Rt(t,e-o)||Rt(t,e+o))}var Nt={EXPLOSION:"explosion",SCREEN_FLASH:"screen_flash"},bo={[Nt.EXPLOSION]:{lifetime:.5,startRadius:.1,endRadius:1,expansionTime:.4,startOpacity:1,endOpacity:0,primaryColor:{h:30,s:90,l:60},secondaryColor:{h:15,s:85,l:50},glowColor:{h:45,s:100,l:75},fillColor:{h:25,s:80,l:40},ringLineWidth:3,glowLineWidth:2,innerLineWidth:1,renderFunction:Ro,ignoreBounds:!1},[Nt.SCREEN_FLASH]:{lifetime:.15,startOpacity:.85,endOpacity:0,color:"#ffffff",renderFunction:Po,ignoreBounds:!0}},jt=[];function qe(t,e,o,n,s={}){let i=bo[t];if(!i)return console.warn(`Unknown effect type: ${t}`),null;let a={ignoreBounds:!1,type:t,x:e,y:o,radius:n,maxRadius:n,age:0,lifetime:s.lifetime??i.lifetime,opacity:s.startOpacity??i.startOpacity,startOpacity:s.startOpacity??i.startOpacity,endOpacity:s.endOpacity??i.endOpacity,...i,...s};return jt.push(a),a}function Ue(t,e,o,n={}){return qe(Nt.EXPLOSION,t,e,o,n)}function G0({color:t="#ffffff",duration:e=.15,alpha:o=.85}={}){qe(Nt.SCREEN_FLASH,0,0,1,{lifetime:e,startOpacity:o,endOpacity:0,color:t,ignoreBounds:!0})}function Ze(t){for(let e=jt.length-1;e>=0;e--){let o=jt[e];o.age+=t;let n=Math.min(o.age/o.lifetime,1);Do(o,n),o.age>=o.lifetime&&jt.splice(e,1)}}function Do(t,e){switch(t.type){case Nt.EXPLOSION:Fo(t,e);break;case Nt.SCREEN_FLASH:_o(t,e);break}}function Fo(t,e){t.opacity=d0(t.startOpacity,t.endOpacity,e);let o=Math.min(e/t.expansionTime,1),n=d0(t.startRadius,t.endRadius,o);t.radius=t.maxRadius*n}function _o(t,e){let o=1-(1-e)*(1-e);t.opacity=d0(t.startOpacity,t.endOpacity,o)}function ko(){return jt}function je(t,e,o,n,s){let i=ko();if(i.length!==0){t.save();for(let a of i)vo(t,a,e,o,n,s);t.restore()}}function vo(t,e,o,n,s,i){let a=Io(e.x,e.y,o,n,s,i,e.ignoreBounds);!a&&!e.ignoreBounds||e.renderFunction(t,e,a)}function Io(t,e,o,n,s,i,a=!1){let l=t-i.x,c=e-i.y,{dirY:d,dirX:h,planeY:g,planeX:y,invDet:x}=o,E=x*(d*l-h*c),p=x*(-g*l+y*c);return p<=.1&&!a?null:a?{x:n/2,y:s/2,radius:s,depth:p}:{x:n/2*(1+E/p),y:s/2+64,radius:s/p*.5,depth:p}}function Ro(t,e,o){let n=o.radius*e.radius,s=performance.now()*.001,i=Math.sin(s*8)*12,a=Math.sin(s*12)*.15+1,l=o.y,c=o.x;t.globalAlpha=e.opacity*.3,t.fillStyle=`hsl(${e.fillColor.h+i*.5}, ${e.fillColor.s}%, ${e.fillColor.l}%)`,t.beginPath(),t.arc(c,l,n*.7,0,2*Math.PI),t.fill(),t.globalAlpha=e.opacity*.5,t.strokeStyle=`hsl(${e.glowColor.h+i}, ${e.glowColor.s}%, ${e.glowColor.l}%)`,t.lineWidth=e.glowLineWidth*1.5,t.beginPath(),t.arc(c,l,n*a,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.85,t.strokeStyle=`hsl(${e.primaryColor.h+i*.8}, ${e.primaryColor.s}%, ${e.primaryColor.l}%)`,t.lineWidth=e.ringLineWidth,t.beginPath(),t.arc(c,l,n*.9,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.6,t.strokeStyle=`hsl(${e.secondaryColor.h+i*1.3}, ${e.secondaryColor.s}%, ${e.secondaryColor.l}%)`,t.lineWidth=e.innerLineWidth,t.beginPath(),t.arc(c,l,n*.5,0,2*Math.PI),t.stroke()}function Po(t,e){if(e.opacity<=0)return;let o=t.canvas.width,n=t.canvas.height;t.save(),t.globalAlpha=e.opacity,t.fillStyle=e.color||"#ffffff",t.fillRect(0,0,o,n),t.restore()}var Jt={[M.entity]:{type:M.entity,ground:!0,scale:.66,floorBiasFrac:0,animationTime:0,animationFrame:0,img:"aiDrone1"},[M.ball]:{type:M.ball,ground:!1,scale:.75,floorBiasFrac:0,cooldownTime:.5,health:3,img:"ball"},[M.sparkle]:{type:M.sparkle,ground:!1,scale:.75,floorBiasFrac:0,cooldownTime:3,img:"sparkle"},[M.barrel]:{type:M.barrel,ground:!0,scale:.66,floorBiasFrac:0,img:"barrel"},[M.food]:{type:M.food,ground:!0,scale:.25,floorBiasFrac:0,img:"food"},[M.key]:{type:M.key,ground:!0,scale:.25,floorBiasFrac:0,img:"keycard1"}},V0=null,Kt=null;function Ke(t,e){V0=t,Kt=e}var Qt={[M.ball]:{ai(t,e){if(!t.alive)return;t.cooldownTime-=e,t.cooldownTime<=0&&(t.cooldownTime=.5,V0&&O.push(V0(M.sparkle,{x:t.x,y:t.y})));let o=r.x-t.x,n=r.y-t.y,s=Math.hypot(o,n);if(s>.3){let i=1*e,a=o/s,l=n/s,c=t.x+a*i,d=t.y+l*i;Mt(c,t.y,.4)||(t.x=c),Mt(t.x,d,.4)||(t.y=d)}s<.6&&t.hurtCD<=0&&(r.health=Math.max(0,r.health-3.33)|0,mt(),S("Ball attacks!"),W.hurt(),t.hurtCD=.8,G0({color:"	#740707",duration:.5}),q0()),t.hurtCD>0&&(t.hurtCD-=e)},onHit(t,e){e?t.health>1?(S(Et(["Ball Hit!"])),t.health-=1,W.killedEntity()):(t.alive=!1,S(Et(["Ball Busted!"])),W.killedEntity()):S("No arrows.")},onTouch(t){g0(M.entity,1e4)&&S("You hear something like echoes nearby...")},onExplode(t){t.alive=!1,W.killedEntity(),S("The ball is blown to bits.")}},[M.sparkle]:{ai(t,e){t.alive&&(t.cooldownTime-=e,t.cooldownTime<=0&&(t.alive=!1))}},[M.entity]:{ai(t,e){if(!t.alive)return;switch(t.animationTime+=e,t.animationTime>.2&&(t.animationTime-=.2,t.animationFrame+=1,t.animationFrame%=4),t.animationFrame){case 0:t.img="aiDrone1";break;case 1:t.img="aiDrone2";break;case 2:t.img="aiDrone3";break;case 3:t.img="aiDrone2";break}let o=r.x-t.x,n=r.y-t.y,s=Math.hypot(o,n);if(s>.3){let i=1.5*e,a=o/s,l=n/s,c=t.x+a*i,d=t.y+l*i;Mt(c,t.y,.4)||(t.x=c),Mt(t.x,d,.4)||(t.y=d)}s<.6&&t.hurtCD<=0&&(r.health=Math.max(0,r.health-3.33)|0,mt(),S("Entity attacks!"),W.hurt(),t.hurtCD=.8,G0({color:"	#740707",duration:.5}),q0()),t.hurtCD>0&&(t.hurtCD-=e)},onHit(t,e){e?(t.alive=!1,S(Et(["Entity murdered!","Entity destroyed!","Entity purged!"])),W.killedEntity()):S("No arrows.")},onTouch(t){g0(M.entity,1e4)&&S("You hear something like water nearby...")},onExplode(t){t.alive=!1,W.killedEntity(),S("The entity is blown to gibs.")}},[M.barrel]:{onHit(t,e){e?(t.alive=!1,Kt&&Kt(t.x,t.y,2.5),S("Kaboom!"),W.explode()):S("No arrows.")},onTouch(t){g0(M.barrel,1e4)&&S("Shooting this barrel may yield useful results...")},onExplode(t){t.alive=!1,Kt&&Kt(t.x,t.y,2.5)}},[M.food]:{onTouch(t){t.alive=!1;let e=r.health>=r.maxHealth;e&&(r.maxHealth+=1),r.health=at(r.health+10,0,r.maxHealth),S(e?"Yummy!":"Health restored."),mt(),W.pickup()},onExplode(t){}},[M.key]:{onTouch(t){t.alive=!1,r.hasBlueKey=!0,W.door(),S("Keycard found! Find the exit!"),$0()},onExplode(t){t.alive=!1,r.hasBlueKey=!0,W.door(),S("The forcefield protecting the exit has suddenly lifted!"),$0()}}};Object.freeze(Jt);for(let t in Jt)Object.freeze(Jt[t]);Object.freeze(Qt);for(let t in Qt)Object.freeze(Qt[t]);var Oo=Jt,Lo=Qt,Ho=0;function At(t,e={x:0,y:0},o=void 0){let n=Oo[t],s=Lo[t],i=Object.assign(Object.create(s),n);return i.id=Ho++,i.x=e.x,i.y=e.y,i.dist=0,i.alive=!0,i.hurtCD=0,o&&Object.assign(i,o),i}function Bo(t,e,o){Ue(t,e,o);for(let n of O){if(!n.alive)continue;Math.hypot(n.x-t,n.y-e)<o&&(n.onExplode?n.onExplode(n):n.alive=!1)}}Ke(At,Bo);var U0=0,q=new Set,Yo=0,Z0=!1;function to(t){window.addEventListener("keydown",e=>{if(q.add(e.code),W0(),z0(),e.code==="Space"&&(e.preventDefault(),Je()),e.code==="KeyM"&&(e.preventDefault(),nt.classList.toggle("visible")),e.code==="Enter"&&(!!document.pointerLockElement||!!document.mozPointerLockElement||!!document.webkitPointerLockElement?document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock():t.requestPointerLock?t.requestPointerLock():t.mozRequestPointerLock?t.mozRequestPointerLock():t.webkitRequestPointerLock&&t.webkitRequestPointerLock()),e.code==="Escape"&&(document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock()),e.code==="BracketLeft")switch(r.mouseSensitivity){case .33:S("Mouse sensitivity set to high."),r.mouseSensitivity=.22;break;case .22:S("Mouse sensitivity set to medium."),r.mouseSensitivity=.11;break;case .11:S("Mouse sensitivity set to low."),r.mouseSensitivity=.05;break;case .05:S("Mouse sensitivity already lowest."),r.mouseSensitivity=.05;break}if(e.code==="BracketRight")switch(r.mouseSensitivity){case .33:S("Mouse sensitivity already set to highest."),r.mouseSensitivity=.33;break;case .22:S("Mouse sensitivity set to highest."),r.mouseSensitivity=.33;break;case .11:S("Mouse sensitivity set to high."),r.mouseSensitivity=.22;break;case .05:S("Mouse sensitivity set to medium."),r.mouseSensitivity=.11;break}}),window.addEventListener("keyup",e=>q.delete(e.code)),t.addEventListener("mousedown",e=>{e.button===0&&Je(),Yo=e.clientX,W0(),z0()}),t.addEventListener("mousemove",e=>{if(!!document.pointerLockElement||!!document.mozPointerLockElement||!!document.webkitPointerLockElement){let n=e.movementX*Math.PI*(.015*r.mouseSensitivity);r.a+=n}}),ue.onclick=()=>Go(),pe.onclick=()=>nt.classList.toggle("visible")}function eo(t){let e=q.has("ShiftLeft")||q.has("ShiftRight"),o=r.rotSpeed*t,n=r.accel*t,s=Math.cos(r.a),i=Math.sin(r.a),a=-i,l=s;r.weaponAnim>.75&&(r.weaponAnim=-1),r.weaponAnim>=0&&(r.weaponAnim+=t);let c=3;r.velX-=r.velX*c*t,r.velY-=r.velY*c*t,Math.abs(r.velX)<.002&&(r.velX=0),Math.abs(r.velY)<.002&&(r.velY=0),r.isMoving=!1;let d=0,h=0;q.has("ArrowLeft")&&(r.a-=o),q.has("ArrowRight")&&(r.a+=o),(q.has("ArrowUp")||q.has("KeyW"))&&(d+=s*n,h+=i*n,r.isMoving=!0),(q.has("ArrowDown")||q.has("KeyS"))&&(d-=s*n,h-=i*n,r.isMoving=!0),q.has("KeyA")&&(d-=a*n,h-=l*n,r.isMoving=!0),q.has("KeyD")&&(d+=a*n,h+=l*n,r.isMoving=!0),r.velX+=d,r.velY+=h;let g=Math.hypot(r.velX,r.velY);g>20&&(r.velX*=20/g,r.velY*=20/g);let y=r.x+r.velX*t,x=r.y+r.velY*t;if(Mt(y,r.y,F0)?r.velX=0:r.x=y,Mt(r.x,x,F0)?r.velY=0:r.y=x,r.health>=0){let E=X[(r.y|0)*f.MAP_W+(r.x|0)],p=f.zones[E]?.floorDepth||0;(r._currentZoneId!==E||r._currentFloorDepth!==p)&&(r._currentZoneId=E,r._currentFloorDepth=p,Ut())}}function Je(){if(r.weaponAnim>=0)return;r.weaponAnim=0,mt(),W.shot();let t=l0(),e=No(t);!e||Zt(e,t).depth>2.5||e.onHit&&e.onHit(e,!0)}function oo(){for(let t of O)!t.alive||Math.hypot(t.x-r.x,t.y-r.y)>=.6||t.onTouch&&t.onTouch(t)}function no(){if(Z0)return;let t=r.x|0,e=r.y|0;f.MAP[e][t]===5&&(W.portal(),S(`Floor ${kt} cleared.`),_0(kt+1),Z0=!0,r.velX=0,r.velY=0,setTimeout(()=>{zo(!0),Z0=!1},100))}function No(t){let o=document.getElementById("view").width>>1|0,n=J[o]||1e9,s=null,i=1e9;for(let a of O){if(!a.alive)continue;let l=Zt(a,t);l&&(r.sightDist>0&&l.depth>r.sightDist||o>=l.drawStartX&&o<l.drawEndX&&l.depth<n+.1&&l.depth<i&&(s=a,i=l.depth))}return s}function t0(t=2){let e=0;for(;e++<200;){let o=(Math.random()*(f.MAP_W-2)|0)+1,n=(Math.random()*(f.MAP_H-2)|0)+1;if(f.MAP[n][o]!==0)continue;let s=o+.5-r.x,i=n+.5-r.y;if(!(Math.hypot(s,i)<t))return{x:o,y:n}}return{x:9,y:9}}var K0=new Map;function ro(){K0.clear();let{MAP_W:t,MAP_H:e,MAP:o,zones:n}=f;for(let s=0;s<n.length;s++){let i=n[s],a=Math.min(i.x,i.x+i.w),l=Math.max(i.x,i.x+i.w)-1,c=Math.min(i.y,i.y+i.h),d=Math.max(i.y,i.y+i.h)-1,h=at(a,0,t-1),g=at(l,0,t-1),y=at(c,0,e-1),x=at(d,0,e-1),E=[];for(let p=y;p<=x;p++)for(let I=h;I<=g;I++)Rt(I,p)||E.push({x:I,y:p});K0.set(s,E)}}function Xo(t){let e=K0.get(t);return!e||e.length===0?null:Et(e)}function $0(){let t=f.MAP_W,e=f.MAP_H;for(let o=0;o<e;o++)for(let n=0;n<t;n++)f.MAP[o][n]===7&&(f.MAP[o][n]=0)}function io(){let t=ct.x,e=ct.y;for(let o=e-1;o<=e+1;o++)for(let n=t-1;n<=t+1;n++)n===t&&o===e||(f.MAP[o][n]=7)}function so(){if(O.length=0,K(100)<50)for(let o=0;o<K(2)*(f.MAP_H/20|0);o++){let n=t0(1);O.push(At(M.barrel,{x:n.x+.5,y:n.y+.5}))}let t=t0(4);O.push(At(M.key,{x:t.x+.5,y:t.y+.5})),t=t0(4),O.push(At(M.food,{x:t.x+.5,y:t.y+.5}));let e=Math.min((2+(kt-1)*2)*(f.MAP_H/20|0),8);for(let o=0;o<e;o++){let n=t0(3.5);O.push(At(M.entity,{x:n.x+.5,y:n.y+.5}))}t=t0(4),O.push(At(M.ball,{x:t.x+.5,y:t.y+.5})),f.zones.forEach((o,n)=>{let s=n;o.spawnRules?.forEach(a=>{let l=Math.max(0,a.amount|0);for(let c=0;c<l;c++){let d=Xo(s);if(!d)break;O.push(At(a.entityType,{x:d.x+.5,y:d.y+.5}))}})})}function mt(){ae.style.width=`${r.health/r.maxHealth*100}%`,le.style.width=`${r.ammo/60*100}%`,ce.textContent=Math.max(0,r.health),fe.textContent=r.ammo}var j0=0,J0=0,Q0=!1,Qe=!1;function S(t){let e=document.getElementById("gameLog"),o=e?.querySelector(".log-items");if(!o)return;let n=o.firstElementChild;if(n){let i=n.innerHTML,a=i.match(/^(.*?)(?:\s+x(\d+))?$/),l=a?a[1]:i,c=a&&a[2]?parseInt(a[2]):1;if(l===t){let d=a&&a[2]?c+1:2;n.innerHTML=`${t} x${d}`;return}}let s=document.createElement("div");s.innerHTML=t,o.prepend(s),e.classList.contains("collapsed")||requestAnimationFrame(()=>{o.scrollTop=0})}function ao(t){j0>0&&(j0-=t,j0<=0&&(de.textContent=r.hasBlueKey?"Find the exit.":"Find the key card."))}function q0(){Q0||r.health<=0&&(Q0=!0,r.speed=0,r.rotSpeed=0,J0=2,S("YOU DIED! Soul disconnecting from the node..."))}function lo(t){Q0&&(J0-=t,J0<=0&&Wo())}function Wo(){if(Qe)return;Qe=!0;let t=document.getElementById("game");if(t){let e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.background="#ff0000",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="999999",e.style.fontFamily='"Courier New", monospace',e.style.opacity="0",e.style.transition="opacity 2s ease-in",e.innerHTML=`
      <div style="
        background: #000;
        border: 3px solid #04650d;
        color: #20b2db;
        width: 600px;
        max-width: 90vw;
        box-shadow: 0 0 20px #04650d;
        font-family: 'Courier New', monospace;
      ">
        <div style="
          background:#000;
          color: #04650d;
          padding: 8px 15px;
          display: flex;
          justify-content: space-between;
          font-weight: bold;
          font-size: 12px;
        ">
          <span style ="color: #FFFFFF; border: 1px solid #04650d;">Death...</span>
        </div>
        <div style="padding: 20px; min-height: 200px;">
          <div style="margin-bottom: 30px;">
            <div style="text-align: center; color: #FFFFFF; font-size: 32px; margin: 8px 0;">YOU HAVE DIED</div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="returnBtn" style="
              background: #000;
              border: 2px solid #04650d;
              color: #04650d;
              padding: 12px 24px;
              font-family: 'Courier New', monospace;
              font-size: 14px;
              font-weight: bold;
              cursor: pointer;
              text-transform: uppercase;
              letter-spacing: 1px;
            ">RETURN TO TERMINAL</button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(e);let o=e.querySelector("#returnBtn");if(o){let n=!1;o.addEventListener("click",s=>{s.preventDefault(),!n&&(n=!0,setTimeout(()=>{window.location.href="../index.html"},100))})}setTimeout(()=>{e.style.opacity="1"},50),t.classList.add("game-paused"),q.clear()}}function te(t=!1){t&&Xt(),r.x=wt.x,r.y=wt.y,r.a=0,r.hasBlueKey=!1,f.MAP[ct.y][ct.x]=5,io(),so(),mt(),S(`Floor ${kt}: Find the keycard.`)}function zo(t=!1){t&&(U0>=Vt.length-1?Xt():(U0+=1,Xt(U0))),r.x=wt.x,r.y=wt.y,r.a=0,r.hasBlueKey=!1,f.MAP[ct.y][ct.x]=5,io(),so(),mt(),S(`Floor ${kt}: Find the keycard.`)}function Go(){_0(1),Xt(0),te()}function co(t){for(let e of O)e.alive&&e.ai&&e.ai(e,t)}var E0=performance.now(),x0=new Map;function g0(t,e=0){if(e===0)return!(E0<x0.get(t));let o=E0,n=x0.get(t)??0;return o<n?!1:(x0.set(t,o+e),!0)}function ai(t){x0.set(t,performance.now())}var ee=m>>1;to(zt);var y0=0;function Vo(t){let e=`FPS: ${Math.round(t)}`;u.save(),u.font="12px monospace",u.textAlign="right",u.textBaseline="top";let o=F-8,n=6,s=u.measureText(e).width+8,i=16;u.fillStyle="rgba(10, 15, 25, 0.6)",u.fillRect(o-s,n-2,s,i),u.strokeStyle="rgba(60, 80, 130, 0.9)",u.strokeRect(o-s+.5,n-2+.5,s-1,i-1),u.fillStyle="#dfe6ff",u.fillText(e,o,n),u.restore()}function Xt(t=-1){let e;if(t!==-1){let o=Vt[t];o&&(e=o.dontPersist?JSON.parse(JSON.stringify(o)):o)}else{let o=Et(Vt);o&&(e=o.dontPersist?JSON.parse(JSON.stringify(o)):o)}ct.x=e.exitPos.x,ct.y=e.exitPos.y,wt.x=e.startPos.x,wt.y=e.startPos.y,r.sightDist=e.sightDist||xe,f.cielingColorFront=e.cielingColorFront||"#6495ED",f.floorColorFront=e.floorColorFront||"#054213",f.cielingColorBack=e.cielingColorBack||"#6495ED",f.floorColorBack=e.floorColorBack||"#03210A",f.MAP=e.mapLayout,f.MAP_W=f.MAP[0].length,f.MAP_H=f.MAP.length,f.zones=e.zones,ro(),ve(),Re(),Ut(),r.x=r.x=e.startPos.x,r.y=e.startPos.y}async function $o(){await Ne(),await Ce(),Xt(0),te(),r.maxHealth=20+K(6),r.health=r.maxHealth,r.ammo=5+K(5),mt(),requestAnimationFrame(fo)}function qo(t){let e=l0();if(f.zones.length<=2)Ie(u);else{for(let o=0;o<F;o++)Oe(t,e,o,0);Be(u)}if(f.zones.length<=2){let o=r.x|0,n=r.y|0,s=X[n*f.MAP_W+o],i=h0[s];if(!i){let a=f.zones[s].fogColor;i=u.createLinearGradient(0,m,0,ee),i.addColorStop(0,f.floorColorFront||"#054213"),i.addColorStop(.85,f.floorColorBack||"#03210A"),i.addColorStop(.95,a||lt),h0[s]=i}u.fillStyle=i,u.fillRect(0,ee,F,ee)}else{for(let o=0;o<F;o++)Pe(t,e,o,0);He(u)}Le(u),Ye(t,e,f.MAP,f.MAP_W,f.MAP_H),Uo(),O.sort((o,n)=>n.dist-o.dist),Zo(e),Jo(t),je(u,e,F,m,r)}function Uo(){for(let t of O){let e=t.x-r.x,o=t.y-r.y;t.dist=e*e+o*o}}function Zo(t){u.save();for(let e of O){if(!e.alive||Math.hypot(e.x-r.x,e.y-r.y)>r.sightDist)continue;let n=Zt(e,t);if(!n||r.sightDist>0&&n.depth>r.sightDist)continue;let s=3,i=0;for(let l=0;l<s;l++){let c=n.drawStartX+l*(n.drawEndX-n.drawStartX)/(s-1);n.depth<=J[Math.floor(c)]&&i++}if(i===0)continue;let a=jo(n);Ko(e,n,a),u.filter="none"}u.restore()}function jo(t){let e=1/(1+t.depth*.3);if(r.sightDist>0&&t.depth>r.sightDist*Ht){let s=r.sightDist*Ht,i=Math.min(1,Math.max(0,(t.depth-s)/Math.max(1e-6,r.sightDist-s)));e*=1-i*.6}let o=[1,.85,.7,.55,.4];return{quantizedShade:o.reduce((s,i)=>Math.abs(i-e)<Math.abs(s-e)?i:s,o[0])}}function Ko(t,e,o){o.quantizedShade<.999&&(u.filter=`brightness(${o.quantizedShade})`);let n=Math.max(1,(e.width??e.drawEndX-e.drawStartX)|0),s=e.drawStartY,i=e.drawEndY-e.drawStartY,a=e.occludedBottom|0;if(a>=i){u.filter="none";return}let l=i-a,c=k[t.img];if(!c){u.filter="none";return}let d=a/i,h=Math.round(c.height*d),g=c.height-h,y=p=>(p-e.drawStartX)*k[t.img].width/n|0,x=-1,E=0;for(let p=e.drawStartX;p<=e.drawEndX;p++){let N=p>=0&&p<F&&p<e.drawEndX&&e.depth<=J[p];if(N&&x===-1&&(x=p,E=y(p)),(!N||p===e.drawEndX)&&x!==-1){let w=p,_=w-x,L=y(w);L<=E&&(L=E+1);let A=Math.min(k[t.img].width-E,L-E);_>0&&A>0&&i>0&&u.drawImage(k[t.img],E,0,A,g,x,s,_,l),x=-1}}}function Jo(t){if(!k.pitchfork)return;let e=Math.round(F*.42),o=Math.round(e*(k.pitchfork.height/k.pitchfork.width)),n=r.isMoving&&r.weaponAnim<0?10*Math.sin(t*5):0,s=Math.max(8,F*.02|0),i=F*.5-e/2-s/2+n,a=(r.weaponAnim+1)**10,l=a>7?7:a,c=r.weaponAnim>=0?100-l*20:0,d=r.isMoving&&r.weaponAnim<0?10*Math.sin(t*10):0,h=m-o-s+70+d+c;u.drawImage(k.pitchfork,i,h,e,o)}function fo(t){let e=Math.min(.05,(t-E0)/1e3);E0=t;let o=e>0?1/e:0;y0=y0?y0*.9+o*.1:o,eo(e),co(e),Ze(e),oo(),qo(t/1e3),nt.classList.contains("visible")&&ze(O),no(),ao(e),lo(e),Vo(y0),C0.drawImage(A0,0,0),requestAnimationFrame(fo)}await $o().catch(console.error);export{Xt as ChangeMapLevel,ai as resetCooldown,g0 as tryCooldown};
