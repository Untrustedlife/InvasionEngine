import{a as Dt,b as ae,c as x}from"../chunks/chunk-75YVQ3JR.js";var Wt=document.getElementById("view");Wt.width=480;Wt.height=270;var b=480,u=270,w0=new OffscreenCanvas(b,u),p=w0.getContext("2d");p.imageSmoothingEnabled=!1;var M0=Wt.getContext("2d");M0.imageSmoothingEnabled=!1;var ot=document.getElementById("mini"),Y=ot.getContext("2d");Y.imageSmoothingEnabled=!1;var se=document.getElementById("hpBar"),le=document.getElementById("ammoBar"),ce=document.getElementById("hpText"),fe=document.getElementById("ammoText"),de=document.getElementById("msg"),pe=document.getElementById("btnReset"),ue=document.getElementById("btnToggleMap");var mo=90*Math.PI/180,C0=mo*.5,S0=.01,T0=.01,xe=15;var Rt=.6,at="#101b2e";var i={x:3.5,y:3.5,velX:0,velY:0,a:0,accel:10,rotSpeed:2.6,health:6,maxHealth:20,ammo:1,hasBlueKey:!1,isMoving:!1,weaponAnim:-1,tenacity:20,maxTenacity:20,height:.75,sightDist:15,mouseSensitivity:.22,height:1.2,calculatePlayerHeight:()=>{if(2-i.height<.01)return .01;let t=i.getCurrentFloorDepth?i.getCurrentFloorDepth():0;return(2-i.height-t)*1},getCurrentZoneId:()=>i._currentZoneId||0,getCurrentFloorDepth:()=>i._currentFloorDepth||0,_currentZoneId:0,_currentFloorDepth:0},b0=.2,Ft=1,Ee=1,ho=99;function D0(t){Ft=Math.max(Ee,Math.min(ho,t|0||Ee))}function i0(){let t=Math.cos(i.a),e=Math.sin(i.a),o=-e*Math.tan(C0),n=t*Math.tan(C0),a=1/(o*e-t*n);return{dirX:t,dirY:e,planeX:o,planeY:n,invDet:a}}var we=[{index:1,image:"OfficeWall.png"},{index:2,image:"Panel.png"},{index:3,image:"Hedge.png"},{index:4,image:"OfficeDoor.png"},{index:5,image:"Portal.png"},{index:6,image:"OfficeDoorBlue.png"},{index:7,image:"Field.png"},{index:8,image:"OfficeWall.png"},{index:9,image:"OfficeDoorBlue.png"}],Me={0:0,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:3,9:3};function go(t=64,e=64){return new OffscreenCanvas(t,e)}var nt=new Array(8).fill(null);function Ae(t){let o=t.getContext("2d").getImageData(0,0,t.width,t.height),n=[];for(let a=0;a<t.width;a++){let r=new Uint8ClampedArray(t.height*4);for(let s=0;s<t.height;s++){let l=(s*t.width+a)*4,c=s*4;r[c]=o.data[l],r[c+1]=o.data[l+1],r[c+2]=o.data[l+2],r[c+3]=o.data[l+3]}n.push({data:r,h:t.height})}return{cols:n,w:t.width,h:t.height}}var zt=nt.map(t=>t?Ae(t):null);function yo(){zt.length=0,nt.forEach(t=>{zt.push(t?Ae(t):null)})}var a0=Array.from({length:82},(t,e)=>e*.0125),r0={};function xo(){for(let t=1;t<nt.length;t++)if(nt[t]){r0[t]={};for(let e of a0){let o=new OffscreenCanvas(nt[t].width,nt[t].height),n=o.getContext("2d");n.drawImage(nt[t],0,0);let a=e*255|0;n.globalCompositeOperation="multiply",n.fillStyle=`rgb(${a},${a},${a})`,n.fillRect(0,0,o.width,o.height),r0[t][e]=o}}}async function Eo(t){let e=`../assets/gfx/${t}`;return new Promise((o,n)=>{let a=new Image;a.onload=()=>{let r=go(64,64),s=r.getContext("2d",{willReadFrequently:!0});s.imageSmoothingEnabled=!1,s.drawImage(a,0,0,64,64),o(r)},a.onerror=()=>n(new Error(`Failed to load texture: ${e}`)),a.src=e})}async function Ce(){try{await wo(we),yo(),xo()}catch(t){console.warn("Failed to init wall textures:",t)}}async function wo(t){if(!Array.isArray(t)){console.warn("Expected an array of { index, image } objects. In loadImagesToReplaceTextures");return}let e=t.map(async(o,n)=>{let{index:a,image:r}=o||{};try{let s=await Eo(r);return a&&a>=0&&(nt[a]=s),s}catch(s){return console.warn(`Failed to load texture "${r}" for index ${a} and dont support replacing with cool gmod missing texture:`,s),null}});await Promise.all(e)}var Se=[{name:"Village",mapLayout:[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,8,8,8,8,8,9,8,8,9,8,8,8,8,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,3],[3,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],exitPos:{x:14,y:14},startPos:{x:9.5,y:1.5},zones:[{color:"#054213",x:0,y:0,w:1,h:1,floorColorBack:"#101b2e",cielingColorFront:"#6495ed",fogColor:"#101b2e",spawnRules:[]},{color:"#0011ff",x:0,y:2,w:20,h:2,cielingColorFront:"#6495ed",cielingColorBack:"#00000000",floorColorBack:"#03210a",fogColor:"#101b2e",spawnRules:[],floorDepth:-.5},{color:"#8b8000",x:3,y:5,w:14,h:12,cielingColorFront:"#8b8000",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",ceilingHeight:6,spawnRules:[{entityType:"entity",amount:5},{entityType:"barrel",amount:5},{entityType:"food",amount:2}]},{color:"#054213",x:1,y:0,w:18,h:19,cielingColorFront:"#6495ed",cielingColorBack:"#00000000",floorColorBack:"#03210a",fogColor:"#101b2e",spawnRules:[]}]},{name:"TowerFloor1",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,3,3,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],[1,0,0,1,6,1,1,1,1,0,0,1,6,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,6,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,1,1,1,1,1,1,0,0,0,1,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1]],exitPos:{x:10,y:17},startPos:{x:5.5,y:4.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000",zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]},{name:"Gallery",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,0,0,0,3,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,1],[1,1,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,1,7,1,1,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,6],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,1,0,0,2,0,0,1],[1,1,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,1,0,0,2,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,2,0,0,1],[4,0,2,2,2,2,2,2,2,2,2,0,6,0,6,0,6,0,6,0,0,2,0,0,1],[1,0,2,2,2,2,2,2,2,2,2,0,1,0,1,0,1,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,3,0,0,0,3,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],exitPos:{x:3,y:3},startPos:{x:1.5,y:21.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#ECDE60",floorColorBack:"#000000",sightDist:10,zones:[{color:"#888000",cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",x:0,y:0,w:0,h:0,spawnRules:[]},{color:"#888000",x:2,y:2,w:4,h:7,cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",spawnRules:[]},{color:"#888000",x:6,y:2,w:12,h:7,cielingColorFront:"#ecde69",cielingColorBack:"#00000000",floorColorBack:"#000000",fogColor:"#000000",spawnRules:[{entityType:"ball",amount:2},{entityType:"food",amount:1}]}]},{name:"LongHallways",mapLayout:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,3,3,3,3,0,4,0,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,1,6,1,1,1,6,1,1,1,6,1,1,1,6,1,1,0,0,3,3,3,3,3,0,0,0,3,3,3,3,3,0,0,1,1,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,6,0,1],[1,7,7,1,1,6,1,1,1,1,1,1,1,1,1,1,1,6,1,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,0,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,6,0,0,0,3,3,3,3,3,0,3,3,3,3,3,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,3,3,3,3,0,3,3,3,3,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,2,3,0,0,0,0,0,3,2,0,0,0,1,0,0,0,0,0,3,3,3,0,3,3,3,0,0,0,0,0,1,1,1],[1,7,7,1,2,2,0,2,2,2,2,6,2,2,2,2,0,2,2,1,0,0,0,0,0,0,3,3,0,3,3,0,0,0,0,0,0,1,1,1],[1,7,7,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,6,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,1,1,1],[1,7,7,1,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,3,3,3,3,3,3,3,3,3,3,3,0,4,0,0,1,1,1],[1,7,7,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1],[1,7,7,1,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,1],[1,7,7,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0,0,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1],[1,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],sightDist:10,exitPos:{x:1,y:1},startPos:{x:9.5,y:3.5},cielingColorFront:"#ECDE60",floorColorFront:"#8B8000",cielingColorBack:"#000000",floorColorBack:"#000000",zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]}];function gt(t){if(!Array.isArray(t)||t.length===0)throw new Error("Array must be non-empty.");let e=j(t.length)-1;return t[e]}function j(t){if(t<=0)throw new Error("The maximum value must be greater than 0.");return Math.floor(Math.random()*t)+1}function s0(t,e,o){return t+(e-t)*o}function Te(t,e){let o=t?t.length:0;if(o===0)return-1;if(e<=t[0])return 0;if(e>=t[o-1])return o-1;let n=0,a=o-1;for(;n<=a;){let r=n+a>>1,s=t[r];if(s===e)return r;s<e?n=r+1:a=r-1}return e-t[a]<=t[n]-e?a:n}function F0(t){let e=t.charCodeAt(0)===35?t.slice(1):t,o=parseInt(e.length===3?e.split("").map(n=>n+n).join(""):e,16);return[o>>16&255,o>>8&255,o&255]}var st={x:10,y:8},yt={x:3.5,y:3.5};var d={MAP:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,2,6,2,0,0,0,0,0,0,0,2,6,2,0,0,1],[1,0,0,0,2,0,2,0,0,0,0,0,0,0,2,0,2,0,0,1],[1,0,0,0,2,2,2,0,0,0,0,0,0,0,2,2,2,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,5,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,0,0,0,3,0,0,0,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,3,3,1,3,3,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,0,0,0,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,3,0,2,2,2,0,3,0,3,0,0,0,1],[1,0,0,0,0,3,0,1,0,2,0,2,0,1,0,3,0,0,0,1],[1,0,0,0,0,0,0,0,0,2,6,2,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],MAP_W:-1,MAP_H:-1,cielingColorFront:"",floorColorFront:"",cielingColorBack:"",floorColorBack:"",dontPersist:!1,sightDist:15,zones:[{color:"#101b2e",x:0,y:0,w:1,h:1}]},Gt=Se,be=new Map;function Fe(t){let e=d.zones,o=e&&e[t]?.color||at,n=be.get(o);return n||(n=F0(o),be.set(o,n)),n}var De=new Map;function ke(t){let e=d.zones,o=e&&e[t]?.cielingColorFront||at,n=De.get(o);return n||(n=F0(o),De.set(o,n)),n}function _e(t,e,o){for(let n=0;n<o.length;n++){let a=o[n],r=Math.min(a.x,a.x+a.w),s=Math.max(a.x,a.x+a.w)-1,l=Math.min(a.y,a.y+a.h),c=Math.max(a.y,a.y+a.h)-1;if(t>=r&&t<=s&&e>=l&&e<=c)return n}return 0}var K=new Float32Array(b),H=u>>1,Vt=new Int16Array(b).fill(H),f0=new Int16Array(b).fill(H),Ot=new Float32Array(u),_0=new Float32Array(u),l0={},Lt={};function qt(){for(let r in Lt)delete Lt[r];for(let r in l0)delete l0[r];let t=H,e=i.calculatePlayerHeight(),n=2-0,a=u*(n-e)*.5;for(let r=0;r<u;r++){let s=r-t;Ot[r]=s!==0?a/s:1e-6;let c=2-2,f=u*(c+e)*.5;_0[r]=s!==0?-f/s:-1e-6}for(let r=0;r<d.zones.length;r++){let s=d.zones[r];if(s.ceilingHeight!==void 0){Lt[r]=new Float32Array(u);for(let l=0;l<u;l++){let c=l-t,g=s.ceilingHeight-2,m=u*(g+e)*.5;Lt[r][l]=c!==0?-m/c:-1e-6}}if(s.floorDepth!==void 0){let c=2-s.floorDepth,f=u*(c-e)*.5;l0[r]=new Float32Array(u);for(let g=0;g<u;g++){let m=g-t;l0[r][g]=m!==0?f/m:1e-6}}}}qt();var v0=[],I0=[],P0=[],d0=[],W=[],R0=[];function ve(){v0.length=0,I0.length=0,P0.length=0,d0.length=0,R0.length=0,O0.clear(),L0.clear()}function $t(t,e,o,n,a,r,s,l,c,f){if(!a)return;let g=n-o;if(g<=0)return;let m=l||0,y=m<0?0:m>a.height?a.height:m,w=c||a.height,E=a.height-y,h=w<0?0:w>E?E:w,O=Te(a0,s);t.drawImage(r0[f][a0[O]],r,y,1,h,e,o,1,g)}function Ie(t){let e=i.x|0,o=i.y|0,n=W[o*d.MAP_W+e],a=v0[n];if(!a){a=t.createLinearGradient(0,0,0,H);let r=d.zones[n].cielingColorFront,s=d.zones[n].cielingColorBack,l=d.zones[n].fogColor;a.addColorStop(0,r||d.cielingColorFront||"#6495ED"),d.cielingColorBack&&a.addColorStop(.5,s||d.cielingColorBack||"#6495ED"),a.addColorStop(.9,l||at),v0[n]=a}t.fillStyle=a,t.fillRect(0,0,b,H)}var O0=new Map;function k0(t){let e=O0.get(t);if(!e){let[o,n,a]=Fe(t);e=`rgb(${o|0},${n|0},${a|0})`,O0.set(t,e)}return e}var L0=new Map;function c0(t){let e=L0.get(t);if(!e){let[o,n,a]=ke(t);e=`rgb(${o|0},${n|0},${a|0})`,L0.set(t,e)}return e}function Pe(){W.length=0;let t=d.zones,e=d.MAP_W,o=d.MAP_H;for(let n=0;n<o;n++)for(let a=0;a<e;a++)W[n*e+a]=_e(a,n,t)}function Re(t,e,o,n=0){let{dirX:a,dirY:r,planeX:s,planeY:l}=e;n=Vt[o]??H;let c=n<H?H:n;if(c>=u)return;let f=2*(o+.5)/b-1,g=a+s*f,m=r+l*f;if(i.sightDist>0){let S=K[o]??1/0;for(;c<u;){let M=Ot[c]??1/0;if(M<=i.sightDist&&M<=S)break;c++}if(c>=u)return}let y="#000000",w=d.MAP_W,E=d.MAP_H,h=1/(a*g+r*m),O=g*h,Q=m*h;function F(S){let M=Ot[S]??Ot[Ot.length-1]??1/0,N=i.x+O*M,V=i.y+Q*M,T=N|0,_=V|0;return T>=0&&_>=0&&T<w&&_<E?W[_*w+T]:0}let L=S=>Math.max(8,Math.min(64,8+(S-H>>>3))),k=F(c),A=c,I=null;for(;c<u;){let S=Math.min(L(c),u-1-c);if(S<=0)break;let M=c+S;if(F(M)===k){let q=c+M>>1;if(F(q)===k){let P=k0(k);P!==I&&(p.fillStyle=P,I=P);let tt=M+1-A;tt>0&&p.fillRect(o,A,1,tt),c=M+1,A=c;continue}}let V=c,T=M;for(;T-V>1;){let q=V+T>>1;F(q)===k?V=q:T=q}let _=k0(k);_!==I&&(p.fillStyle=_,I=_);let Yt=T-A;Yt>0&&p.fillRect(o,A,1,Yt);let Xt=F(T),t0=d.zones[k]?.floorDepth??0,g0=d.zones[Xt]?.floorDepth??0,y0=Vt[o]??H,te=Ot[T]??1/0,ee=K[o]??1/0,e0=T<=y0,o0=te>=ee-.1;if(!!y&&t0!==g0&&!e0&&!o0&&!(A===y0)){let q=t0>g0?5:1,P=T,tt=Math.min(u,P+q);tt>P&&(p.fillStyle!==y&&(p.fillStyle=y),p.fillRect(o,P,1,tt-P)),I=null,k=Xt,c=tt,A=c;continue}k=Xt,c=T,A=c}if(A<u){let S=k0(k);S!==I&&(p.fillStyle=S),p.fillRect(o,A,1,u-A)}}function Oe(t,e,o,n=0){let{dirX:a,dirY:r,planeX:s,planeY:l}=e,c=f0[o]??H,f=0;if(c<=0)return;let g=2*(o+.5)/b-1,m=a+s*g,y=r+l*g,w=1/(a*m+r*y),E=0,h=Lt?.[E]?.[f]??_0[f],O=i.x+m*h*w,Q=i.y+y*h*w,F=f,L=null;for(let A=f;A<c;A++){if(i.sightDist>0&&Math.abs(h)>i.sightDist){let T=c0(E);T!==L&&(p.fillStyle=T),p.fillRect(o,F,1,A-F);return}if(h>K[o]){let T=c0(E);T!==L&&(p.fillStyle=T),p.fillRect(o,F,1,A-F);return}let I=O|0,S=Q|0,M=I>=0&&S>=0&&I<d.MAP_W&&S<d.MAP_H?W[S*d.MAP_W+I]:E;if(M!==E){let T=c0(E);T!==L&&(p.fillStyle=T,L=T),p.fillRect(o,F,1,A-F),E=M,F=A}let N=Lt?.[E]?.[A+1]??_0[A+1]??h,V=N-h;O+=m*V*w,Q+=y*V*w,h=N}let k=c0(E);k!==L&&(p.fillStyle=k),p.fillRect(o,F,1,c-F)}function Le(t){let e=P0[0];e||(e=t.createLinearGradient(0,0,0,u),e.addColorStop(0,"rgba(16,27,46,0.08)"),e.addColorStop(.5,"rgba(16,27,46,0.16)"),e.addColorStop(1,"rgba(16,27,46,0.20)"),P0[0]=e),t.fillStyle=e,t.fillRect(0,0,b,u)}function He(t){let e=H-1,o=u-e,n=i.x|0,a=i.y|0,r=W[a*d.MAP_W+n],s=I0[r];if(!s){let l=d.zones[r].floorColorBack;s=t.createLinearGradient(0,e,0,u),s.addColorStop(.05,d.zones[r].fogColor||at),s.addColorStop(.15,l||d.floorColorBack||"#03210A"),s.addColorStop(1,"rgba(0,0,0,0)"),I0[r]=s}t.fillStyle=s,t.fillRect(0,e,b,o)}function Be(t){let o=H+1,n=i.x|0,a=i.y|0,r=W[a*d.MAP_W+n],s=R0[r];if(!s){let l=d.zones[r].fogColor||at,c=d.zones[r].cielingColorBack||d.cielingColorBack||"#6495ED";s=t.createLinearGradient(0,0,0,0+o),s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(.85,c),s.addColorStop(.95,l),R0[r]=s}t.fillStyle=s,t.fillRect(0,0,b,o)}function Ye(t,e,o,n,a){let{dirX:r,dirY:s,planeX:l,planeY:c}=e;for(let f=0;f<b;f++){let g=2*(f+.5)/b-1,m=r+l*g,y=s+c*g;if(m<1e-8&&m>-1e-8&&y<1e-8&&y>-1e-8){K[f]=Number.POSITIVE_INFINITY,Vt[f]=H,f0[f]=H;continue}let w=1/(m||1e-9),E=1/(y||1e-9),h=i.x|0,O=i.y|0,Q=w<0?-w:w,F=E<0?-E:E,L,k,A,I;m<0?(L=-1,A=(i.x-h)*Q):(L=1,A=(h+1-i.x)*Q),y<0?(k=-1,I=(i.y-O)*F):(k=1,I=(O+1-i.y)*F);let S=0,M=1,N=!1,V=0,T=0;for(;!N&&V++<256;){if(A<I?(A+=Q,h+=L,S=0):(I+=F,O+=k,S=1),i.sightDist>0){let Z=Math.min(A,I);if(Z>i.sightDist){N=!1,M=0,T=Z;break}}if(h<0||O<0||h>=n||O>=a){N=!0,M=1;break}let B=o[O][h];if(B>0){N=!0,M=B;break}}if(M===0){K[f]=Number.POSITIVE_INFINITY,Vt[f]=H,f0[f]=H;continue}let _;S===0?_=A-Q:_=I-F,_=S0>_?S0:_;let Yt=0,Xt=S===0?L:0,t0=S===1?k:0,e0=Math.abs(Xt*r+t0*s)>=.9&&Math.abs(g)<=.9&&_<Yt?Yt:_,o0=i.x+e0*m,x0=i.y+e0*y,pt;S===0?pt=x0-(x0|0):pt=o0-(o0|0),pt=pt<0?0:pt>.999999?.999999:pt+1e-6;let q=zt[M]||zt[4],P=nt[M],tt=P?P.width|0:q.w|0,et=pt*tt|0;(S===0&&L>0||S===1&&k<0)&&(et=tt-et-1),et=et<0?0:et>=tt?tt-1:et;let po=_<T0?T0:_,wt=u/po|0,Nt=(u-wt*i.calculatePlayerHeight())/2|0,E0=Nt+wt,ft=Nt,Mt=E0;ft<0&&(ft=0),Mt>u&&(Mt=u);let oe=Mt-ft;Vt[f]=Mt;let At=Me[M]||1;if(f0[f]=ft*At,oe<=0){K[f]=_;continue}let ne=(P?P.height:q.h||nt[M]?.height||64)|0,ie=(ft-Nt)*(ne/(wt>1?wt:1)),re=oe*(ne/Math.max(1,wt)),It=1/(1+_*.25)*(S?.5:1);if(M===7&&(It*=.8+.2*Math.sin(t*6+f*.05)),At==1)$t(p,f,ft,Mt,P,et,It,ie,re,M);else if(At>1){$t(p,f,ft,Mt,P,et,It,ie,re,M);let B=wt,Z=(P?.height||q.h||64)|0,it=Z/Math.max(1,B),ut=Math.floor(At)-1;for(let U=0;U<ut;U++){let mt=Nt-B*(U+1),Ct=E0-B*(U+1),rt=Math.max(0,Math.ceil(mt)),ht=Math.min(u,Math.floor(Ct)),St=ht-rt;if(St<=0)continue;let Tt=(rt-mt)*it,bt=St*it;$t(p,f,rt,ht,P,et,It,Tt,bt,1)}let Pt=At-(1+ut);if(Pt>1e-6){let U=B*Pt,mt=Nt-B*ut,Ct=mt-U,rt=Math.max(0,Math.ceil(Ct)),ht=Math.min(u,Math.floor(mt)),St=ht-rt;if(St>0){let Tt=mt-B,bt=(rt-Tt)*it%Z;bt<0&&(bt+=Z);let uo=St*it;$t(p,f,rt,ht,P,et,It,bt,uo,1)}}}else if(At<1){let B=wt,Z=(P?.height||q.h||64)|0,it=Z/Math.max(1,B),ut=At;if(ut>1e-6){let Pt=B*ut,U=E0,mt=U-Pt,Ct=Math.max(0,Math.ceil(mt)),rt=Math.min(u,Math.floor(U)),ht=rt-Ct;if(ht>0){let St=U-B,Tt=(Ct-St)*it%Z;Tt<0&&(Tt+=Z);let bt=ht*it;$t(p,f,Ct,rt,P,et,It,Tt,bt,M)}}}if(i.sightDist>0&&_>i.sightDist*Rt){let B=i.sightDist*Rt,Z=i.sightDist,it=Math.min(1,Math.max(0,(_-B)/Math.max(1e-6,Z-B)));if(it>0){let ut=i.x|0,Pt=i.y|0,U=W.length>0?W[Pt*d.MAP_W+ut]:0;p.save(),p.globalAlpha=it*.85,p.fillStyle=d.zones[U].fogColor||at,p.fillRect(f,ft,1,Mt-ft),p.restore()}}K[f]=_}}var D={aiDrone1:null,ball:null,sparkle:null,barrel:null,food:null,keycard1:null,aiDrone2:null,aiDrone3:null,pitchfork:null,bow:null};async function lt(t,e){return await Mo(t,e,1)}async function Mo(t,e=1,o=1){let n=`../assets/gfx/${t}`;return new Promise((a,r)=>{let s=new Image;s.onload=()=>{let l=new OffscreenCanvas(s.width*e,s.height*e),c=l.getContext("2d");c.imageSmoothingEnabled=!1,c.drawImage(s,0,0,l.width,l.height),l.baseline=o,l.scale=e,a(l)},s.onerror=()=>r(new Error(`Failed to load sprite: ${n}`)),s.src=n})}async function Xe(){D.food=await lt("noodles.png",3),D.bow=await lt("bow.png",3),D.pitchfork=await lt("pitchfork.png",3),D.keycard1=await lt("keycard1.png",3),D.barrel=await lt("emp.png",3),D.aiDrone1=await lt("aiDrone1.png",3),D.aiDrone2=await lt("aiDrone2.png",3),D.aiDrone3=await lt("aiDrone3.png",3),D.ball=await lt("Palantrash1.png",3),D.sparkle=await lt("sparkle.png",3)}var R=[];function Ao(t){return u/t}function Co(t,e,o){let{dirY:n,dirX:a,planeY:r,planeX:s,invDet:l}=o,c=l*(n*t-a*e),f=l*(-r*t+s*e);return{transX:c,transY:f}}function So(t,e){return Math.round((b>>1)*(1+t/e))}function Zt(t,e){let o=t.x-i.x,n=t.y-i.y,{transX:a,transY:r}=Co(o,n,e);if(r<=.01)return null;let s=So(a,r),l=t&&typeof t.scale=="number"?t.scale:t&&D[t.img]&&typeof D[t.img].scale=="number"?D[t.img].scale:1,c=Ao(r)*l,f=typeof t._hR=="number"?t._hR:Math.round(c),g=.1,m=f;(c>f+g||c<f-g)&&(m=Math.round(c)),t._hR=m;let y=m,w=D[t.img],E=w&&w.width&&w.height?w.width/w.height:1,h=Math.max(1,Math.round(y*E)),O=u,Q=i.calculatePlayerHeight(),F=u*.5,L,k;if(t.ground){let M=t.floorBiasFrac??.04,N=F+u*(2-Q)/(2*r)-M*y,V=N-y;L=Math.round(V),k=Math.round(N)}else{let M=Math.round(F-y*.5);L=M,k=M+y}let A={startY:L,endY:k},I=Math.round(s-(h>>1)),S=I+h;return{drawStartX:I,drawEndX:S,drawStartY:A.startY,drawEndY:A.endY,depth:r,size:y,width:S-I}}var Ne={0:"#0c1220",1:"#ECDE60",2:"#707a88",3:"#00e676",4:"#996633",5:"#FFE300",6:" #3561ff",7:"#00FFFF"},H0={[x.entity]:"#ffeb9c",[x.barrel]:"#CD1C18",[x.key]:"#6aa2ff",[x.food]:"#7fffd4",default:"#ffffff"};var J=6,kt=20,ct=2,We=Math.floor(kt/2);ot.width=ct+kt*J+ct;ot.height=ct+kt*J+ct;function ze(t){Y.clearRect(0,0,ot.width,ot.height);let e=Math.max(0,Math.min((i.x|0)-We,d.MAP_W-kt)),o=Math.max(0,Math.min((i.y|0)-We,d.MAP_H-kt));for(let l=0;l<kt;l++)for(let c=0;c<kt;c++){let f=o+l,g=e+c,m=d.MAP[f]?.[g]??0,y=Ne[m]||"#000000";Y.fillStyle=y,Y.fillRect(ct+c*J,ct+l*J,J-1,J-1)}for(let l of t){if(!l.alive)continue;let c=ct+(l.x-e)*J,f=ct+(l.y-o)*J;Y.fillStyle=H0[l.type]||H0.default,Y.fillRect(c-2,f-2,4,4)}let n=ct+(i.x-e)*J,a=ct+(i.y-o)*J;Y.fillStyle="#e7f3ff",Y.beginPath(),Y.arc(n,a,2.5,0,ae),Y.fill();let r=Math.cos(i.a),s=Math.sin(i.a);Y.strokeStyle="#78f3d3",Y.beginPath(),Y.moveTo(n,a),Y.lineTo(n+r*1.5*J,a+s*1.5*J),Y.stroke()}var v=null,_t=null,G=null,B0=null,Ge=null;function X0(){v||(v=new(window.AudioContext||window.webkitAudioContext))}function z({freq:t=440,dur:e=.1,type:o="square",vol:n=.2,slide:a=0}){if(!v)return;let r=v.createOscillator(),s=v.createGain();r.type=o,r.frequency.value=t,s.gain.value=n,r.connect(s).connect(v.destination);let l=v.currentTime;a&&(r.frequency.setValueAtTime(t,l),r.frequency.linearRampToValueAtTime(t+a,l+e)),s.gain.setValueAtTime(n,l),s.gain.exponentialRampToValueAtTime(.001,l+e),r.start(l),r.stop(l+e)}function Y0({dur:t=.2,vol:e=.2,lp:o=1200}){if(!v)return;let n=v.createBuffer(1,v.sampleRate*t,v.sampleRate),a=n.getChannelData(0);for(let f=0;f<a.length;f++)a[f]=Math.random()*2-1;let r=v.createBufferSource(),s=v.createGain(),l=v.createBiquadFilter();r.buffer=n,s.gain.value=e,l.type="lowpass",l.frequency.value=o,r.connect(l).connect(s).connect(v.destination);let c=v.currentTime;r.start(c),r.stop(c+t)}var X={shot:()=>{let t=j(50),e=-j(50);z({freq:220+t+e,dur:.05+j(3)/100,type:"square",vol:.25,slide:120}),Y0({dur:.03+j(3)/100,vol:.15,lp:800})},pickup:()=>{z({freq:880,dur:.06,type:"triangle",vol:.2}),z({freq:1180,dur:.08,type:"triangle",vol:.18})},explode:()=>{Y0({dur:1,vol:.3,lp:800}),z({freq:90,dur:.7,type:"sawtooth",vol:.12,slide:-60})},hurt:()=>{z({freq:140,dur:.12,type:"sawtooth",vol:.2,slide:-50})},killedEntity:()=>{let t=Math.random()*16-8;z({freq:320+t,dur:.26,type:"triangle",vol:.3,slide:-220}),z({freq:480+t,dur:.22,type:"sawtooth",vol:.1,slide:-260}),z({freq:90,dur:.08,type:"sine",vol:.18}),Y0({dur:.05,vol:.1,lp:1e3}),setTimeout(()=>{z({freq:170+t,dur:.07,type:"triangle",vol:.16,slide:70})},90)},door:()=>{z({freq:420,dur:.12,type:"square",vol:.15})},portal:()=>{z({freq:600,dur:.5,type:"sawtooth",vol:.2}),z({freq:400,dur:.3,type:"sawtooth",vol:.2,slide:50}),z({freq:600,dur:.5,type:"sawtooth",vol:.2})}};async function To(t,{volume:e=.15}={}){if(v)try{if(!B0||t!==Ge){let n=await(await fetch(t,{cache:"force-cache"})).arrayBuffer();B0=await v.decodeAudioData(n),Ge=t}$e(),G=v.createBufferSource(),G.buffer=B0,G.loop=!0,_t=v.createGain(),_t.gain.value=e,G.connect(_t).connect(v.destination),G.start()}catch(o){try{$e();let n=new Audio(t);n.loop=!0,n.volume=Math.max(0,Math.min(1,e)),await n.play(),G={stop:()=>n.pause(),disconnect:()=>{}},_t=null}catch(n){}}}function $e(){try{G&&G.stop(0)}catch(t){}if(G&&G.disconnect)try{G.disconnect()}catch(t){}if(_t)try{_t.disconnect()}catch(t){}G=null,_t=null}var Ve=!1;async function N0(){if(!v||G||Ve)return;Ve=!0,await To("../assets/sfx/HexenST02SLowed.ogg",{volume:.12})}function vt(t,e){if(t<0||e<0||t>=d.MAP_W||e>=d.MAP_H)return!0;let o=d.MAP[e|0][t|0];return o===0||o===5?!1:o===7?!i.hasBlueKey:!(o===6||o===9)}function xt(t,e,o){return!!(vt(t,e)||vt(t-o,e)||vt(t+o,e)||vt(t,e-o)||vt(t,e+o))}var Ht={EXPLOSION:"explosion",SCREEN_FLASH:"screen_flash"},bo={[Ht.EXPLOSION]:{lifetime:.5,startRadius:.1,endRadius:1,expansionTime:.4,startOpacity:1,endOpacity:0,primaryColor:{h:30,s:90,l:60},secondaryColor:{h:15,s:85,l:50},glowColor:{h:45,s:100,l:75},fillColor:{h:25,s:80,l:40},ringLineWidth:3,glowLineWidth:2,innerLineWidth:1,renderFunction:Po,ignoreBounds:!1},[Ht.SCREEN_FLASH]:{lifetime:.15,startOpacity:.85,endOpacity:0,color:"#ffffff",renderFunction:Ro,ignoreBounds:!0}},Ut=[];function qe(t,e,o,n,a={}){let r=bo[t];if(!r)return console.warn(`Unknown effect type: ${t}`),null;let s={ignoreBounds:!1,type:t,x:e,y:o,radius:n,maxRadius:n,age:0,lifetime:a.lifetime??r.lifetime,opacity:a.startOpacity??r.startOpacity,startOpacity:a.startOpacity??r.startOpacity,endOpacity:a.endOpacity??r.endOpacity,...r,...a};return Ut.push(s),s}function Ze(t,e,o,n={}){return qe(Ht.EXPLOSION,t,e,o,n)}function W0({color:t="#ffffff",duration:e=.15,alpha:o=.85}={}){qe(Ht.SCREEN_FLASH,0,0,1,{lifetime:e,startOpacity:o,endOpacity:0,color:t,ignoreBounds:!0})}function Ue(t){for(let e=Ut.length-1;e>=0;e--){let o=Ut[e];o.age+=t;let n=Math.min(o.age/o.lifetime,1);Do(o,n),o.age>=o.lifetime&&Ut.splice(e,1)}}function Do(t,e){switch(t.type){case Ht.EXPLOSION:Fo(t,e);break;case Ht.SCREEN_FLASH:ko(t,e);break}}function Fo(t,e){t.opacity=s0(t.startOpacity,t.endOpacity,e);let o=Math.min(e/t.expansionTime,1),n=s0(t.startRadius,t.endRadius,o);t.radius=t.maxRadius*n}function ko(t,e){let o=1-(1-e)*(1-e);t.opacity=s0(t.startOpacity,t.endOpacity,o)}function _o(){return Ut}function je(t,e,o,n,a){let r=_o();if(r.length!==0){t.save();for(let s of r)vo(t,s,e,o,n,a);t.restore()}}function vo(t,e,o,n,a,r){let s=Io(e.x,e.y,o,n,a,r,e.ignoreBounds);!s&&!e.ignoreBounds||e.renderFunction(t,e,s)}function Io(t,e,o,n,a,r,s=!1){let l=t-r.x,c=e-r.y,{dirY:f,dirX:g,planeY:m,planeX:y,invDet:w}=o,E=w*(f*l-g*c),h=w*(-m*l+y*c);return h<=.1&&!s?null:s?{x:n/2,y:a/2,radius:a,depth:h}:{x:n/2*(1+E/h),y:a/2+64,radius:a/h*.5,depth:h}}function Po(t,e,o){let n=o.radius*e.radius,a=performance.now()*.001,r=Math.sin(a*8)*12,s=Math.sin(a*12)*.15+1,l=o.y,c=o.x;t.globalAlpha=e.opacity*.3,t.fillStyle=`hsl(${e.fillColor.h+r*.5}, ${e.fillColor.s}%, ${e.fillColor.l}%)`,t.beginPath(),t.arc(c,l,n*.7,0,2*Math.PI),t.fill(),t.globalAlpha=e.opacity*.5,t.strokeStyle=`hsl(${e.glowColor.h+r}, ${e.glowColor.s}%, ${e.glowColor.l}%)`,t.lineWidth=e.glowLineWidth*1.5,t.beginPath(),t.arc(c,l,n*s,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.85,t.strokeStyle=`hsl(${e.primaryColor.h+r*.8}, ${e.primaryColor.s}%, ${e.primaryColor.l}%)`,t.lineWidth=e.ringLineWidth,t.beginPath(),t.arc(c,l,n*.9,0,2*Math.PI),t.stroke(),t.globalAlpha=e.opacity*.6,t.strokeStyle=`hsl(${e.secondaryColor.h+r*1.3}, ${e.secondaryColor.s}%, ${e.secondaryColor.l}%)`,t.lineWidth=e.innerLineWidth,t.beginPath(),t.arc(c,l,n*.5,0,2*Math.PI),t.stroke()}function Ro(t,e){if(e.opacity<=0)return;let o=t.canvas.width,n=t.canvas.height;t.save(),t.globalAlpha=e.opacity,t.fillStyle=e.color||"#ffffff",t.fillRect(0,0,o,n),t.restore()}var Kt={[x.entity]:{type:x.entity,ground:!0,scale:.66,floorBiasFrac:0,animationTime:0,animationFrame:0,img:"aiDrone1"},[x.ball]:{type:x.ball,ground:!1,scale:.75,floorBiasFrac:0,cooldownTime:.5,health:3,img:"ball"},[x.sparkle]:{type:x.sparkle,ground:!1,scale:.75,floorBiasFrac:0,cooldownTime:3,img:"sparkle"},[x.barrel]:{type:x.barrel,ground:!0,scale:.66,floorBiasFrac:0,img:"barrel"},[x.food]:{type:x.food,ground:!0,scale:.25,floorBiasFrac:0,img:"food"},[x.key]:{type:x.key,ground:!0,scale:.25,floorBiasFrac:0,img:"keycard1"}},z0=null,jt=null;function Ke(t,e){z0=t,jt=e}var Jt={[x.ball]:{ai(t,e){if(!t.alive)return;t.cooldownTime-=e,t.cooldownTime<=0&&(t.cooldownTime=.5,z0&&R.push(z0(x.sparkle,{x:t.x,y:t.y})));let o=i.x-t.x,n=i.y-t.y,a=Math.hypot(o,n);if(a>.3){let r=1*e,s=o/a,l=n/a,c=t.x+s*r,f=t.y+l*r;xt(c,t.y,.4)||(t.x=c),xt(t.x,f,.4)||(t.y=f)}a<.6&&t.hurtCD<=0&&(i.health=Math.max(0,i.health-3.33)|0,dt(),C("Ball attacks!"),X.hurt(),t.hurtCD=.8,W0({color:"	#740707",duration:.5}),$0()),t.hurtCD>0&&(t.hurtCD-=e)},onHit(t,e){e?t.health>1?(C(gt(["Ball Hit!"])),t.health-=1,X.killedEntity()):(t.alive=!1,C(gt(["Ball Busted!"])),X.killedEntity()):C("No arrows.")},onTouch(t){p0(x.entity,1e4)&&C("You hear something like echoes nearby...")},onExplode(t){t.alive=!1,X.killedEntity(),C("The ball is blown to bits.")}},[x.sparkle]:{ai(t,e){t.alive&&(t.cooldownTime-=e,t.cooldownTime<=0&&(t.alive=!1))}},[x.entity]:{ai(t,e){if(!t.alive)return;switch(t.animationTime+=e,t.animationTime>.2&&(t.animationTime-=.2,t.animationFrame+=1,t.animationFrame%=4),t.animationFrame){case 0:t.img="aiDrone1";break;case 1:t.img="aiDrone2";break;case 2:t.img="aiDrone3";break;case 3:t.img="aiDrone2";break}let o=i.x-t.x,n=i.y-t.y,a=Math.hypot(o,n);if(a>.3){let r=1.5*e,s=o/a,l=n/a,c=t.x+s*r,f=t.y+l*r;xt(c,t.y,.4)||(t.x=c),xt(t.x,f,.4)||(t.y=f)}a<.6&&t.hurtCD<=0&&(i.health=Math.max(0,i.health-3.33)|0,dt(),C("Entity attacks!"),X.hurt(),t.hurtCD=.8,W0({color:"	#740707",duration:.5}),$0()),t.hurtCD>0&&(t.hurtCD-=e)},onHit(t,e){e?(t.alive=!1,C(gt(["Entity murdered!","Entity destroyed!","Entity purged!"])),X.killedEntity()):C("No arrows.")},onTouch(t){p0(x.entity,1e4)&&C("You hear something like water nearby...")},onExplode(t){t.alive=!1,X.killedEntity(),C("The entity is blown to gibs.")}},[x.barrel]:{onHit(t,e){e?(t.alive=!1,jt&&jt(t.x,t.y,2.5),C("Kaboom!"),X.explode()):C("No arrows.")},onTouch(t){p0(x.barrel,1e4)&&C("Shooting this barrel may yield useful results...")},onExplode(t){t.alive=!1,jt&&jt(t.x,t.y,2.5)}},[x.food]:{onTouch(t){t.alive=!1;let e=i.health>=i.maxHealth;e&&(i.maxHealth+=1),i.health=Dt(i.health+10,0,i.maxHealth),C(e?"Yummy!":"Health restored."),dt(),X.pickup()},onExplode(t){}},[x.key]:{onTouch(t){t.alive=!1,i.hasBlueKey=!0,X.door(),C("Keycard found! Find the exit!"),G0()},onExplode(t){t.alive=!1,i.hasBlueKey=!0,X.door(),C("The forcefield protecting the exit has suddenly lifted!"),G0()}}};Object.freeze(Kt);for(let t in Kt)Object.freeze(Kt[t]);Object.freeze(Jt);for(let t in Jt)Object.freeze(Jt[t]);var Oo=Kt,Lo=Jt,Ho=0;function Et(t,e={x:0,y:0},o=void 0){let n=Oo[t],a=Lo[t],r=Object.assign(Object.create(a),n);return r.id=Ho++,r.x=e.x,r.y=e.y,r.dist=0,r.alive=!0,r.hurtCD=0,o&&Object.assign(r,o),r}function Bo(t,e,o){Ze(t,e,o);for(let n of R){if(!n.alive)continue;Math.hypot(n.x-t,n.y-e)<o&&(n.onExplode?n.onExplode(n):n.alive=!1)}}Ke(Et,Bo);var V0=0,$=new Set,Yo=0,q0=!1;function to(t){window.addEventListener("keydown",e=>{if($.add(e.code),X0(),N0(),e.code==="Space"&&(e.preventDefault(),Je()),e.code==="KeyM"&&(e.preventDefault(),ot.classList.toggle("visible")),e.code==="Enter"&&(!!document.pointerLockElement||!!document.mozPointerLockElement||!!document.webkitPointerLockElement?document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock():t.requestPointerLock?t.requestPointerLock():t.mozRequestPointerLock?t.mozRequestPointerLock():t.webkitRequestPointerLock&&t.webkitRequestPointerLock()),e.code==="Escape"&&(document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock()),e.code==="BracketLeft")switch(i.mouseSensitivity){case .33:C("Mouse sensitivity set to high."),i.mouseSensitivity=.22;break;case .22:C("Mouse sensitivity set to medium."),i.mouseSensitivity=.11;break;case .11:C("Mouse sensitivity set to low."),i.mouseSensitivity=.05;break;case .05:C("Mouse sensitivity already lowest."),i.mouseSensitivity=.05;break}if(e.code==="BracketRight")switch(i.mouseSensitivity){case .33:C("Mouse sensitivity already set to highest."),i.mouseSensitivity=.33;break;case .22:C("Mouse sensitivity set to highest."),i.mouseSensitivity=.33;break;case .11:C("Mouse sensitivity set to high."),i.mouseSensitivity=.22;break;case .05:C("Mouse sensitivity set to medium."),i.mouseSensitivity=.11;break}}),window.addEventListener("keyup",e=>$.delete(e.code)),t.addEventListener("mousedown",e=>{e.button===0&&Je(),Yo=e.clientX,X0(),N0()}),t.addEventListener("mousemove",e=>{if(!!document.pointerLockElement||!!document.mozPointerLockElement||!!document.webkitPointerLockElement){let n=e.movementX*Math.PI*(.015*i.mouseSensitivity);i.a+=n}}),pe.onclick=()=>Go(),ue.onclick=()=>ot.classList.toggle("visible")}function eo(t){let e=$.has("ShiftLeft")||$.has("ShiftRight"),o=i.rotSpeed*t,n=i.accel*t,a=Math.cos(i.a),r=Math.sin(i.a),s=-r,l=a;i.weaponAnim>.75&&(i.weaponAnim=-1),i.weaponAnim>=0&&(i.weaponAnim+=t);let c=3;i.velX-=i.velX*c*t,i.velY-=i.velY*c*t,Math.abs(i.velX)<.002&&(i.velX=0),Math.abs(i.velY)<.002&&(i.velY=0),i.isMoving=!1;let f=0,g=0;$.has("ArrowLeft")&&(i.a-=o),$.has("ArrowRight")&&(i.a+=o),($.has("ArrowUp")||$.has("KeyW"))&&(f+=a*n,g+=r*n,i.isMoving=!0),($.has("ArrowDown")||$.has("KeyS"))&&(f-=a*n,g-=r*n,i.isMoving=!0),$.has("KeyA")&&(f-=s*n,g-=l*n,i.isMoving=!0),$.has("KeyD")&&(f+=s*n,g+=l*n,i.isMoving=!0),i.velX+=f,i.velY+=g;let m=Math.hypot(i.velX,i.velY);m>20&&(i.velX*=20/m,i.velY*=20/m);let y=i.x+i.velX*t,w=i.y+i.velY*t;if(xt(y,i.y,b0)?i.velX=0:i.x=y,xt(i.x,w,b0)?i.velY=0:i.y=w,i.health>=0){let E=W[(i.y|0)*d.MAP_W+(i.x|0)],h=d.zones[E]?.floorDepth||0;(i._currentZoneId!==E||i._currentFloorDepth!==h)&&(i._currentZoneId=E,i._currentFloorDepth=h,qt())}}function Je(){if(i.weaponAnim>=0)return;i.weaponAnim=0,dt(),X.shot();let t=i0(),e=Xo(t);!e||Zt(e,t).depth>2.5||e.onHit&&e.onHit(e,!0)}function oo(){for(let t of R)!t.alive||Math.hypot(t.x-i.x,t.y-i.y)>=.6||t.onTouch&&t.onTouch(t)}function no(){if(q0)return;let t=i.x|0,e=i.y|0;d.MAP[e][t]===5&&(X.portal(),C(`Floor ${Ft} cleared.`),D0(Ft+1),q0=!0,i.velX=0,i.velY=0,setTimeout(()=>{zo(!0),q0=!1},100))}function Xo(t){let o=document.getElementById("view").width>>1|0,n=K[o]||1e9,a=null,r=1e9;for(let s of R){if(!s.alive)continue;let l=Zt(s,t);l&&(i.sightDist>0&&l.depth>i.sightDist||o>=l.drawStartX&&o<l.drawEndX&&l.depth<n+.1&&l.depth<r&&(a=s,r=l.depth))}return a}function Qt(t=2){let e=0;for(;e++<200;){let o=(Math.random()*(d.MAP_W-2)|0)+1,n=(Math.random()*(d.MAP_H-2)|0)+1;if(d.MAP[n][o]!==0)continue;let a=o+.5-i.x,r=n+.5-i.y;if(!(Math.hypot(a,r)<t))return{x:o,y:n}}return{x:9,y:9}}var U0=new Map;function io(){U0.clear();let{MAP_W:t,MAP_H:e,MAP:o,zones:n}=d;for(let a=0;a<n.length;a++){let r=n[a],s=Math.min(r.x,r.x+r.w),l=Math.max(r.x,r.x+r.w)-1,c=Math.min(r.y,r.y+r.h),f=Math.max(r.y,r.y+r.h)-1,g=Dt(s,0,t-1),m=Dt(l,0,t-1),y=Dt(c,0,e-1),w=Dt(f,0,e-1),E=[];for(let h=y;h<=w;h++)for(let O=g;O<=m;O++)vt(O,h)||E.push({x:O,y:h});U0.set(a,E)}}function No(t){let e=U0.get(t);return!e||e.length===0?null:gt(e)}function G0(){let t=d.MAP_W,e=d.MAP_H;for(let o=0;o<e;o++)for(let n=0;n<t;n++)d.MAP[o][n]===7&&(d.MAP[o][n]=0)}function ro(){let t=st.x,e=st.y;for(let o=e-1;o<=e+1;o++)for(let n=t-1;n<=t+1;n++)n===t&&o===e||(d.MAP[o][n]=7)}function ao(){if(R.length=0,j(100)<50)for(let o=0;o<j(2)*(d.MAP_H/20|0);o++){let n=Qt(1);R.push(Et(x.barrel,{x:n.x+.5,y:n.y+.5}))}let t=Qt(4);R.push(Et(x.key,{x:t.x+.5,y:t.y+.5})),t=Qt(4),R.push(Et(x.food,{x:t.x+.5,y:t.y+.5}));let e=Math.min((2+(Ft-1)*2)*(d.MAP_H/20|0),8);for(let o=0;o<e;o++){let n=Qt(3.5);R.push(Et(x.entity,{x:n.x+.5,y:n.y+.5}))}t=Qt(4),R.push(Et(x.ball,{x:t.x+.5,y:t.y+.5})),d.zones.forEach((o,n)=>{let a=n;o.spawnRules?.forEach(s=>{let l=Math.max(0,s.amount|0);for(let c=0;c<l;c++){let f=No(a);if(!f)break;R.push(Et(s.entityType,{x:f.x+.5,y:f.y+.5}))}})})}function dt(){se.style.width=`${i.health/i.maxHealth*100}%`,le.style.width=`${i.ammo/60*100}%`,ce.textContent=Math.max(0,i.health),fe.textContent=i.ammo}var Z0=0,j0=0,K0=!1,Qe=!1;function C(t){let e=document.getElementById("gameLog"),o=e?.querySelector(".log-items");if(!o)return;let n=o.firstElementChild;if(n){let r=n.innerHTML,s=r.match(/^(.*?)(?:\s+x(\d+))?$/),l=s?s[1]:r,c=s&&s[2]?parseInt(s[2]):1;if(l===t){let f=s&&s[2]?c+1:2;n.innerHTML=`${t} x${f}`;return}}let a=document.createElement("div");a.innerHTML=t,o.prepend(a),e.classList.contains("collapsed")||requestAnimationFrame(()=>{o.scrollTop=0})}function so(t){Z0>0&&(Z0-=t,Z0<=0&&(de.textContent=i.hasBlueKey?"Find the exit.":"Find the key card."))}function $0(){K0||i.health<=0&&(K0=!0,i.speed=0,i.rotSpeed=0,j0=2,C("YOU DIED! Soul disconnecting from the node..."))}function lo(t){K0&&(j0-=t,j0<=0&&Wo())}function Wo(){if(Qe)return;Qe=!0;let t=document.getElementById("game");if(t){let e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.background="#ff0000",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="999999",e.style.fontFamily='"Courier New", monospace',e.style.opacity="0",e.style.transition="opacity 2s ease-in",e.innerHTML=`
      <div style="
        background: #000;
        border: 3px solid #04650d;
        color: #20b2db;
        width: 600px;
        max-width: 90vw;
        box-shadow: 0 0 20px #04650d;
        font-family: 'Courier New', monospace;
      ">
        <div style="
          background:#000;
          color: #04650d;
          padding: 8px 15px;
          display: flex;
          justify-content: space-between;
          font-weight: bold;
          font-size: 12px;
        ">
          <span style ="color: #FFFFFF; border: 1px solid #04650d;">Death...</span>
        </div>
        <div style="padding: 20px; min-height: 200px;">
          <div style="margin-bottom: 30px;">
            <div style="text-align: center; color: #FFFFFF; font-size: 32px; margin: 8px 0;">YOU HAVE DIED</div>
          </div>
          <div style="text-align: center; margin-top: 20px;">
            <button id="returnBtn" style="
              background: #000;
              border: 2px solid #04650d;
              color: #04650d;
              padding: 12px 24px;
              font-family: 'Courier New', monospace;
              font-size: 14px;
              font-weight: bold;
              cursor: pointer;
              text-transform: uppercase;
              letter-spacing: 1px;
            ">RETURN TO TERMINAL</button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(e);let o=e.querySelector("#returnBtn");if(o){let n=!1;o.addEventListener("click",a=>{a.preventDefault(),!n&&(n=!0,setTimeout(()=>{window.location.href="../index.html"},100))})}setTimeout(()=>{e.style.opacity="1"},50),t.classList.add("game-paused"),$.clear()}}function J0(t=!1){t&&Bt(),i.x=yt.x,i.y=yt.y,i.a=0,i.hasBlueKey=!1,d.MAP[st.y][st.x]=5,ro(),ao(),dt(),C(`Floor ${Ft}: Find the keycard.`)}function zo(t=!1){t&&(V0>=Gt.length-1?Bt():(V0+=1,Bt(V0))),i.x=yt.x,i.y=yt.y,i.a=0,i.hasBlueKey=!1,d.MAP[st.y][st.x]=5,ro(),ao(),dt(),C(`Floor ${Ft}: Find the keycard.`)}function Go(){D0(1),Bt(0),J0()}function co(t){for(let e of R)e.alive&&e.ai&&e.ai(e,t)}var h0=performance.now(),m0=new Map;function p0(t,e=0){if(e===0)return!(h0<m0.get(t));let o=h0,n=m0.get(t)??0;return o<n?!1:(m0.set(t,o+e),!0)}function ar(t){m0.set(t,performance.now())}var Q0=u>>1;to(Wt);var u0=0;function $o(t){let e=`FPS: ${Math.round(t)}`;p.save(),p.font="12px monospace",p.textAlign="right",p.textBaseline="top";let o=b-8,n=6,a=p.measureText(e).width+8,r=16;p.fillStyle="rgba(10, 15, 25, 0.6)",p.fillRect(o-a,n-2,a,r),p.strokeStyle="rgba(60, 80, 130, 0.9)",p.strokeRect(o-a+.5,n-2+.5,a-1,r-1),p.fillStyle="#dfe6ff",p.fillText(e,o,n),p.restore()}function Bt(t=-1){let e;if(t!==-1){let o=Gt[t];o&&(e=o.dontPersist?JSON.parse(JSON.stringify(o)):o)}else{let o=gt(Gt);o&&(e=o.dontPersist?JSON.parse(JSON.stringify(o)):o)}st.x=e.exitPos.x,st.y=e.exitPos.y,yt.x=e.startPos.x,yt.y=e.startPos.y,i.sightDist=e.sightDist||xe,d.cielingColorFront=e.cielingColorFront||"#6495ED",d.floorColorFront=e.floorColorFront||"#054213",d.cielingColorBack=e.cielingColorBack||"#6495ED",d.floorColorBack=e.floorColorBack||"#03210A",d.MAP=e.mapLayout,d.MAP_W=d.MAP[0].length,d.MAP_H=d.MAP.length,d.zones=e.zones,io(),ve(),Pe(),qt(),i.x=i.x=e.startPos.x,i.y=e.startPos.y}async function Vo(){await Xe(),await Ce(),Bt(0),J0(),i.maxHealth=20+j(6),i.health=i.maxHealth,i.ammo=5+j(5),dt(),requestAnimationFrame(fo)}function qo(t){let e=i0();if(d.zones.length<=2)Ie(p);else{for(let o=0;o<b;o++)Oe(t,e,o,0);Be(p)}if(d.zones.length<=2){let o=i.x|0,n=i.y|0,a=W[n*d.MAP_W+o],r=d0[a];if(!r){let s=d.zones[a].fogColor;r=p.createLinearGradient(0,u,0,Q0),r.addColorStop(0,d.floorColorFront||"#054213"),r.addColorStop(.85,d.floorColorBack||"#03210A"),r.addColorStop(.95,s||at),d0[a]=r}p.fillStyle=r,p.fillRect(0,Q0,b,Q0)}else{for(let o=0;o<b;o++)Re(t,e,o,0);He(p)}Le(p),Ye(t,e,d.MAP,d.MAP_W,d.MAP_H),Zo(),R.sort((o,n)=>n.dist-o.dist),Uo(e),Jo(t),je(p,e,b,u,i)}function Zo(){for(let t of R){let e=t.x-i.x,o=t.y-i.y;t.dist=e*e+o*o}}function Uo(t){p.save();for(let e of R){if(!e.alive||Math.hypot(e.x-i.x,e.y-i.y)>i.sightDist)continue;let n=Zt(e,t);if(!n||i.sightDist>0&&n.depth>i.sightDist)continue;let a=3,r=0;for(let l=0;l<a;l++){let c=n.drawStartX+l*(n.drawEndX-n.drawStartX)/(a-1);n.depth<=K[Math.floor(c)]&&r++}if(r===0)continue;let s=jo(n);Ko(e,n,s),p.filter="none"}p.restore()}function jo(t){let e=1/(1+t.depth*.3);if(i.sightDist>0&&t.depth>i.sightDist*Rt){let a=i.sightDist*Rt,r=Math.min(1,Math.max(0,(t.depth-a)/Math.max(1e-6,i.sightDist-a)));e*=1-r*.6}let o=[1,.85,.7,.55,.4];return{quantizedShade:o.reduce((a,r)=>Math.abs(r-e)<Math.abs(a-e)?r:a,o[0])}}function Ko(t,e,o){o.quantizedShade<.999&&(p.filter=`brightness(${o.quantizedShade})`);let n=Math.max(1,(e.width??e.drawEndX-e.drawStartX)|0),a=e.drawStartY,r=e.drawEndY-e.drawStartY,s=f=>(f-e.drawStartX)*D[t.img].width/n|0,l=-1,c=0;for(let f=e.drawStartX;f<=e.drawEndX;f++){let m=f>=0&&f<b&&f<e.drawEndX&&e.depth<=K[f];if(m&&l===-1&&(l=f,c=s(f)),(!m||f===e.drawEndX)&&l!==-1){let y=f,w=y-l,E=s(y);E<=c&&(E=c+1);let h=Math.min(D[t.img].width-c,E-c);w>0&&h>0&&r>0&&p.drawImage(D[t.img],c,0,h,D[t.img].height,l,a,w,r),l=-1}}}function Jo(t){if(!D.pitchfork)return;let e=Math.round(b*.42),o=Math.round(e*(D.pitchfork.height/D.pitchfork.width)),n=i.isMoving&&i.weaponAnim<0?10*Math.sin(t*5):0,a=Math.max(8,b*.02|0),r=b*.5-e/2-a/2+n,s=(i.weaponAnim+1)**10,l=s>7?7:s,c=i.weaponAnim>=0?100-l*20:0,f=i.isMoving&&i.weaponAnim<0?10*Math.sin(t*10):0,g=u-o-a+70+f+c;p.drawImage(D.pitchfork,r,g,e,o)}function fo(t){let e=Math.min(.05,(t-h0)/1e3);h0=t;let o=e>0?1/e:0;u0=u0?u0*.9+o*.1:o,eo(e),co(e),Ue(e),oo(),qo(t/1e3),ot.classList.contains("visible")&&ze(R),no(),so(e),lo(e),$o(u0),M0.drawImage(w0,0,0),requestAnimationFrame(fo)}await Vo().catch(console.error);export{Bt as ChangeMapLevel,ar as resetCooldown,p0 as tryCooldown};
