<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Map Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="styles/_variables.css?v=1.2" />
    <link rel="stylesheet" href="styles/map-editor.css?v=1.2" />
  </head>
  <body>
    <div class="terminal-container">
      <div class="terminal-content">
        <!-- OS Header -->
        <div class="os-header">
          <h1 class="os-title">Map Editor --Terminal</h1>
          <p class="os-version">MAP.EDITOR.rbn Tile Editor System</p>
        </div>

        <div class="terminal-prompt">
          ]MAP_EDITOR<span class="cursor"></span>
        </div>

        <div class="editor-layout">
          <!-- LEFT: Tileset Panel -->
          <section class="terminal-panel" id="tilePanel">
            <div class="panel-header">TILESET CONTROLS</div>

            <div class="control-row">
              <div class="control-group">
                <label>MAX TILE ID (0..255)</label>
                <input id="maxId" type="number" value="7" min="0" max="255" />
              </div>
              <button id="genBtn">GENERATE IDS</button>
            </div>

            <div class="button-row">
              <button id="seedWolf3dBtn">SEED SAMPLE MAP</button>
              <button id="resetNamesBtn">AUTO-NAME TILES</button>
            </div>

            <div class="section-header">TILE PALETTE</div>
            <div id="palList" class="palette-list"></div>

            <div class="terminal-text">
              > Right-click canvas to eyedrop tile ID > Use number keys 0-9 to
              select tiles
            </div>

            <div class="control-row">
              <div class="control-group">
                <label>ACTIVE TILE ID</label>
                <input
                  id="activeId"
                  type="number"
                  value="1"
                  min="0"
                  max="255"
                />
              </div>
              <div class="id-badge" id="activeBadge">ID: 1</div>
            </div>
          </section>

          <!-- LEFT: Zone Panel (hidden by default) -->
          <section class="terminal-panel" id="zonePanel" style="display: none">
            <div class="panel-header">ZONE CONTROLS</div>

            <div class="section-header">
              ZONE LAYERS (Lower = Higher Priority)
            </div>
            <div class="button-row">
              <button id="addZoneBtn">ADD NEW ZONE</button>
            </div>
            <div id="zoneLayerPanel" class="zone-layer-panel">
              <div class="zone-layer-list" id="zoneLayerList">
                <div class="zone-empty-message">No zones created</div>
              </div>
            </div>

            <div id="zoneProperties" class="zone-properties">
              <div class="section-header">SELECTED ZONE</div>
              <div class="zone-none" id="noZoneSelected">No zone selected</div>

              <div class="zone-editor" id="zoneEditor" style="display: none">
                <div class="control-row">
                  <div class="control-group">
                    <label>ZONE ID</label>
                    <span id="zoneId" class="zone-id-display">-</span>
                  </div>
                </div>

                <div class="control-row">
                  <div class="control-group">
                    <label>POSITION X</label>
                    <input id="zoneX" type="number" min="0" max="255" />
                  </div>
                  <div class="control-group">
                    <label>POSITION Y</label>
                    <input id="zoneY" type="number" min="0" max="255" />
                  </div>
                </div>

                <div class="control-row">
                  <div class="control-group">
                    <label>WIDTH</label>
                    <input id="zoneW" type="number" min="1" max="256" />
                  </div>
                  <div class="control-group">
                    <label>HEIGHT</label>
                    <input id="zoneH" type="number" min="1" max="256" />
                  </div>
                </div>

                <div class="control-row">
                  <div class="control-group">
                    <label>ZONE COLOR</label>
                    <input id="zoneColor" type="color" value="#271810" />
                  </div>
                </div>

                <div class="control-row">
                  <div class="control-group">
                    <label>CEILING FRONT</label>
                    <input id="zoneCeilFront" type="color" value="#271810" />
                  </div>
                  <div class="control-group">
                    <label>CEILING BACK</label>
                    <input id="zoneCeilBack" type="color" value="#271810" />
                  </div>
                  <div class="control-group">
                    <label>FLOOR BACK</label>
                    <input id="zoneFloorBack" type="color" value="#000000" />
                  </div>
                  <div class="control-group">
                    <label>Zone Fog</label>
                    <input id="zoneFogColor" type="color" value="#000000" />
                  </div>
                </div>
                <div class="section-header">SPAWN RULES</div>
                <div id="spawnRulesContainer">
                  <div id="spawnRulesList" class="spawn-rules-list">
                    <!-- Spawn rules will be populated here -->
                  </div>

                  <div class="add-spawn-rule-section">
                    <div class="control-row">
                      <div class="control-group">
                        <label>ENTITY</label>
                        <select id="spawnRuleEntity">
                          <!-- Populated by JavaScript -->
                        </select>
                      </div>
                      <div class="control-group">
                        <label>AMOUNT</label>
                        <input
                          id="spawnRuleAmount"
                          type="number"
                          min="1"
                          max="99"
                          value="1"
                        />
                      </div>
                      <button id="addSpawnRuleBtn">ADD RULE</button>
                    </div>
                  </div>
                </div>
                <div class="button-row">
                  <button id="deleteZoneBtn" class="danger-btn">
                    DELETE ZONE
                  </button>
                </div>
            </div>
            <div class="terminal-text">
              > Left-click: Create/Select zones > Right-click: Delete zone >
              Drag corners/edges to resize
            </div>
          </section>

          <!-- CENTER: Canvas Editor -->
          <section class="canvas-panel">
            <div class="panel-header">MAP EDITOR</div>

            <div class="canvas-controls">
              <div class="control-row">
                <div class="control-group">
                  <label>WIDTH</label>
                  <input id="w" type="number" value="20" min="1" max="256" />
                </div>
                <div class="control-group">
                  <label>HEIGHT</label>
                  <input id="h" type="number" value="20" min="1" max="256" />
                </div>
                <div class="control-group">
                  <label>ZOOM</label>
                  <input id="cell" type="number" value="16" min="2" max="48" />
                </div>
              </div>

              <div class="button-row">
                <button id="resizeBtn">RESIZE</button>
                <button id="clearBtn">CLEAR</button>
                <button id="fillBtn">FILL</button>
                <button id="gridBtn">GRID: ON</button>
                <button id="undoBtn">UNDO</button>
                <button id="redoBtn">REDO</button>
              </div>

              <div class="mode-controls">
                <button id="modeBtn" class="mode-toggle">
                  MODE: TILE EDIT
                </button>
              </div>
            </div>

            <canvas id="editor" width="320" height="320" tabindex="0"></canvas>

            <div class="status-bar">
              <span id="status">POSITION: (-, -) TILE: -</span>
              <span class="controls-text"
                >LMB: PAINT | RMB: EYEDROP | CTRL+Z/Y: UNDO/REDO</span
              >
            </div>

            <!-- Zone Mini Panel (shown in tile mode when zones exist) -->
            <div
              id="zoneMiniPanel"
              class="zone-mini-panel"
              style="display: none"
            >
              <div class="zone-mini-header">ZONES OVERLAY</div>
              <div id="zoneMiniList" class="zone-mini-list"></div>
            </div>
          </section>

          <!-- RIGHT: Import/Export Panel -->
          <section class="terminal-panel">
            <div class="panel-header">IMPORT / EXPORT</div>

            <div class="section-header">EXPORT JAVASCRIPT</div>
            <div class="control-group">
              <label>MAP NAME</label>
              <input
                id="mapName"
                value="Village"
                placeholder="Enter map name"
              />
            </div>
            <div class="control-group">
              <label>MAP CONSTANT NAME</label>
              <input id="jsMapName" value="MAP" />
            </div>
            <div class="button-row">
              <button id="exportTsBtn">GENERATE JS</button>
              <button id="copyTsBtn">COPY</button>
              <button id="downloadTsBtn">DOWNLOAD</button>
            </div>

            <div class="section-header">EXPORT JSON</div>
            <button id="downloadJsonBtn">DOWNLOAD JSON</button>

            <textarea
              id="io"
              spellcheck="false"
              placeholder="//PASTE FULL JSON OF MAP HERE TO LOAD IT\nCOPY FROM HERE TO EXPORT."
            ></textarea>

            <div class="button-row">
              <button id="loadArrayBtn">LOAD DATA</button>
              <button id="loadSampleBtn">LOAD SAMPLE</button>
            </div>

            <div class="terminal-text">
              > Generated JS includes: export const MAP > Format: 2D number[][]
              array
            </div>

            <div class="back-link">
              <a href="../index.html">‚Üê RETURN TO TERMINAL</a>
            </div>
          </section>
        </div>

        <!-- System Status Bar -->
        <div class="system-status">
          <span>MAP EDITOR READY</span>
          <span>VERSION: 1.3</span>
          <span>SYSTEM: APPLE II</span>
        </div>
      </div>
    </div>
    <script type="module" src="../src/editor/MapEditor.js?v=1.2"></script>
  </body>
</html>
